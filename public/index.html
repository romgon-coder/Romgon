    <!-- Sign Up Modal -->
    <div id="signup-modal" style="
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(20, 24, 32, 0.98);
        z-index: 3001;
        overflow-y: auto;
        padding: 0; margin: 0;
        backdrop-filter: blur(4px);
    ">
        <div style="
            max-width: 500px;
            margin: 80px auto;
            background: #23272e;
            border-radius: 18px;
            box-shadow: 0 8px 40px #000a;
            padding: 40px 36px;
            color: #fff;
            position: relative;
        ">
            <button onclick="hideSignUpModal()" style="
                position: absolute; top: 18px; right: 18px;
                background: #ff6b6b; color: #23272e;
                border: none; border-radius: 8px;
                font-size: 1.2em; font-weight: bold;
                padding: 6px 16px; cursor: pointer; z-index: 10;
                transition: all 0.3s ease;
            " onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">‚úñÔ∏è</button>
            
            <h2 style="color: #ff6b6b; margin-top: 0; text-align: center; font-size: 1.8em;">üìù Create Account</h2>
            <p style="color: #aaa; text-align: center; margin-bottom: 30px;">Join to save your progress and stats</p>
            
            <form id="signup-form" onsubmit="handleSignUp(event)" style="display: flex; flex-direction: column; gap: 18px;">
                <div>
                    <label style="display: block; color: #4ecdc4; font-weight: bold; margin-bottom: 8px;">Username</label>
                    <input type="text" id="signup-username" placeholder="Choose a username" required style="
                        width: 100%;
                        padding: 12px 16px;
                        background: #1a1e26;
                        border: 2px solid #4ecdc4;
                        border-radius: 8px;
                        color: #fff;
                        font-size: 1em;
                        box-sizing: border-box;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.borderColor='#5eddd4'" onmouseout="this.style.borderColor='#4ecdc4'" onfocus="this.style.boxShadow='0 0 12px rgba(78, 205, 196, 0.3)'" onblur="this.style.boxShadow='none'">
                </div>
                
                <div>
                    <label style="display: block; color: #4ecdc4; font-weight: bold; margin-bottom: 8px;">Email</label>
                    <input type="email" id="signup-email" placeholder="your.email@example.com" required style="
                        width: 100%;
                        padding: 12px 16px;
                        background: #1a1e26;
                        border: 2px solid #4ecdc4;
                        border-radius: 8px;
                        color: #fff;
                        font-size: 1em;
                        box-sizing: border-box;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.borderColor='#5eddd4'" onmouseout="this.style.borderColor='#4ecdc4'" onfocus="this.style.boxShadow='0 0 12px rgba(78, 205, 196, 0.3)'" onblur="this.style.boxShadow='none'">
                </div>
                
                <div>
                    <label style="display: block; color: #4ecdc4; font-weight: bold; margin-bottom: 8px;">Password</label>
                    <input type="password" id="signup-password" placeholder="Enter password (min 6 characters)" required minlength="6" style="
                        width: 100%;
                        padding: 12px 16px;
                        background: #1a1e26;
                        border: 2px solid #4ecdc4;
                        border-radius: 8px;
                        color: #fff;
                        font-size: 1em;
                        box-sizing: border-box;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.borderColor='#5eddd4'" onmouseout="this.style.borderColor='#4ecdc4'" onfocus="this.style.boxShadow='0 0 12px rgba(78, 205, 196, 0.3)'" onblur="this.style.boxShadow='none'">
                </div>
                
                <div>
                    <label style="display: block; color: #4ecdc4; font-weight: bold; margin-bottom: 8px;">Confirm Password</label>
                    <input type="password" id="signup-confirm-password" placeholder="Re-enter your password" required minlength="6" style="
                        width: 100%;
                        padding: 12px 16px;
                        background: #1a1e26;
                        border: 2px solid #4ecdc4;
                        border-radius: 8px;
                        color: #fff;
                        font-size: 1em;
                        box-sizing: border-box;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.borderColor='#5eddd4'" onmouseout="this.style.borderColor='#4ecdc4'" onfocus="this.style.boxShadow='0 0 12px rgba(78, 205, 196, 0.3)'" onblur="this.style.boxShadow='none'">
                </div>
                
                <div id="signup-error" style="display: none; background: rgba(255, 107, 107, 0.2); color: #ff8a8a; padding: 12px; border-radius: 8px; font-size: 0.95em; text-align: center; border-left: 4px solid #ff6b6b;"></div>
                
                <button type="submit" style="
                    background: linear-gradient(135deg, #ff6b6b, #ff8a8a);
                    color: white;
                    border: none;
                    padding: 14px 24px;
                    border-radius: 8px;
                    font-weight: 700;
                    font-size: 0.95em;
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
                    transition: all 0.3s ease;
                    margin-top: 10px;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(255, 107, 107, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255, 107, 107, 0.3)'">
                    ‚úì Create Account
                </button>
            </form>
            
            <p style="color: #888; text-align: center; margin-top: 24px; font-size: 0.95em;">
                Already have an account? <a href="#" onclick="hideSignUpModal(); showLoginOptions();" style="color: #4ecdc4; text-decoration: none; font-weight: bold;">Sign in with Google</a>
            </p>
        </div>
    </div>

    <!-- Enhanced Sign In Modal -->
    <div id="signin-modal" style="
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(15, 20, 30, 0.98);
        z-index: 3001;
        overflow-y: auto;
        padding: 0; margin: 0;
        backdrop-filter: blur(8px);
    ">
        <div style="
            max-width: 480px;
            margin: 60px auto;
            background: linear-gradient(135deg, #23272e 0%, #2c313a 100%);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            padding: 50px 40px;
            color: #fff;
            position: relative;
            border: 1px solid rgba(102, 126, 234, 0.3);
        ">
            <!-- Close Button -->
            <button onclick="hideSignInModal()" style="
                position: absolute; top: 20px; right: 20px;
                background: rgba(255, 107, 107, 0.2);
                color: #ff6b6b;
                border: 2px solid #ff6b6b;
                border-radius: 50%;
                width: 42px;
                height: 42px;
                font-size: 1.4em;
                font-weight: bold;
                cursor: pointer;
                z-index: 10;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
            " onmouseover="this.style.background='rgba(255, 107, 107, 0.3)'; this.style.transform='rotate(90deg)'" onmouseout="this.style.background='rgba(255, 107, 107, 0.2)'; this.style.transform='rotate(0)'">√ó</button>
            
            <!-- Header -->
            <div style="text-align: center; margin-bottom: 40px;">
                <div style="
                    width: 80px;
                    height: 80px;
                    margin: 0 auto 20px;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 40px;
                    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
                ">üîê</div>
                <h2 style="color: #667eea; margin: 0 0 10px 0; font-size: 2em; font-weight: 800;">Welcome Back!</h2>
                <p style="color: #aaa; margin: 0; font-size: 0.95em;">Sign in to continue your strategy journey</p>
            </div>
            
            <!-- Login Form -->
            <form id="signin-form" onsubmit="handleSignIn(event)" style="display: flex; flex-direction: column; gap: 20px;">
                <!-- Username/Email -->
                <div>
                    <label style="display: block; color: #667eea; font-weight: 600; margin-bottom: 10px; font-size: 0.95em;">
                        <span style="margin-right: 8px;">üë§</span> Username or Email
                    </label>
                    <input type="text" id="signin-username" placeholder="Enter your username or email" required style="
                        width: 100%;
                        padding: 14px 18px;
                        background: rgba(26, 30, 38, 0.8);
                        border: 2px solid rgba(102, 126, 234, 0.3);
                        border-radius: 12px;
                        color: #fff;
                        font-size: 1em;
                        box-sizing: border-box;
                        transition: all 0.3s ease;
                    " onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 20px rgba(102, 126, 234, 0.3)'; this.style.background='rgba(26, 30, 38, 1)'" onblur="this.style.borderColor='rgba(102, 126, 234, 0.3)'; this.style.boxShadow='none'; this.style.background='rgba(26, 30, 38, 0.8)'">
                </div>
                
                <!-- Password with Toggle -->
                <div>
                    <label style="display: block; color: #667eea; font-weight: 600; margin-bottom: 10px; font-size: 0.95em;">
                        <span style="margin-right: 8px;">üîë</span> Password
                    </label>
                    <div style="position: relative;">
                        <input type="password" id="signin-password" placeholder="Enter your password" required style="
                            width: 100%;
                            padding: 14px 18px;
                            padding-right: 50px;
                            background: rgba(26, 30, 38, 0.8);
                            border: 2px solid rgba(102, 126, 234, 0.3);
                            border-radius: 12px;
                            color: #fff;
                            font-size: 1em;
                            box-sizing: border-box;
                            transition: all 0.3s ease;
                        " onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 20px rgba(102, 126, 234, 0.3)'; this.style.background='rgba(26, 30, 38, 1)'" onblur="this.style.borderColor='rgba(102, 126, 234, 0.3)'; this.style.boxShadow='none'; this.style.background='rgba(26, 30, 38, 0.8)'">
                        <button type="button" onclick="toggleSignInPassword()" style="
                            position: absolute;
                            right: 15px;
                            top: 50%;
                            transform: translateY(-50%);
                            background: transparent;
                            border: none;
                            color: #667eea;
                            cursor: pointer;
                            font-size: 1.2em;
                            padding: 5px;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.color='#764ba2'" onmouseout="this.style.color='#667eea'">üëÅÔ∏è</button>
                    </div>
                </div>
                
                <!-- Remember Me & Forgot Password -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: -10px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; color: #aaa; font-size: 0.9em;">
                        <input type="checkbox" id="remember-me" style="
                            width: 18px;
                            height: 18px;
                            cursor: pointer;
                            accent-color: #667eea;
                        ">
                        <span>Remember me</span>
                    </label>
                    <a href="#" onclick="alert('Password reset coming soon!'); return false;" style="
                        color: #667eea;
                        text-decoration: none;
                        font-size: 0.9em;
                        font-weight: 600;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.color='#764ba2'; this.style.textDecoration='underline'" onmouseout="this.style.color='#667eea'; this.style.textDecoration='none'">
                        Forgot password?
                    </a>
                </div>
                
                <!-- Error Message -->
                <div id="signin-error" style="
                    display: none;
                    background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(255, 107, 107, 0.1));
                    color: #ff8a8a;
                    padding: 14px 16px;
                    border-radius: 12px;
                    font-size: 0.95em;
                    text-align: center;
                    border-left: 4px solid #ff6b6b;
                    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.2);
                "></div>
                
                <!-- Sign In Button -->
                <button type="submit" style="
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    border: none;
                    padding: 16px 24px;
                    border-radius: 12px;
                    font-weight: 700;
                    font-size: 1.05em;
                    cursor: pointer;
                    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
                    transition: all 0.3s ease;
                    margin-top: 10px;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 10px 30px rgba(102, 126, 234, 0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'">
                    ‚úì Sign In
                </button>
            </form>
            
            <!-- Divider -->
            <div style="
                display: flex;
                align-items: center;
                gap: 15px;
                margin: 30px 0;
                color: #666;
                font-size: 0.9em;
            ">
                <div style="flex: 1; height: 1px; background: linear-gradient(90deg, transparent, #444, transparent);"></div>
                <span>OR</span>
                <div style="flex: 1; height: 1px; background: linear-gradient(90deg, transparent, #444, transparent);"></div>
            </div>
            
            <!-- Social Login Options -->
            <div style="display: flex; flex-direction: column; gap: 12px;">
                <button onclick="handleGoogleLogin()" style="
                    background: rgba(255, 255, 255, 0.05);
                    color: #fff;
                    border: 2px solid rgba(255, 255, 255, 0.1);
                    padding: 14px 20px;
                    border-radius: 12px;
                    cursor: pointer;
                    font-weight: 600;
                    font-size: 0.95em;
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 12px;
                " onmouseover="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.borderColor='rgba(255, 255, 255, 0.2)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.05)'; this.style.borderColor='rgba(255, 255, 255, 0.1)'">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Continue with Google
                </button>
                
                <button onclick="handleGuestLoginWithBackend()" style="
                    background: linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(78, 205, 196, 0.1));
                    color: #4ecdc4;
                    border: 2px solid rgba(78, 205, 196, 0.5);
                    padding: 14px 20px;
                    border-radius: 12px;
                    cursor: pointer;
                    font-weight: 600;
                    font-size: 0.95em;
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 12px;
                " onmouseover="this.style.background='linear-gradient(135deg, rgba(78, 205, 196, 0.3), rgba(78, 205, 196, 0.2))'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(78, 205, 196, 0.1))'; this.style.transform='translateY(0)'">
                    üéÆ Quick Play as Guest
                </button>
            </div>
            
            <!-- Sign Up Link -->
            <p style="
                color: #888;
                text-align: center;
                margin-top: 30px;
                font-size: 0.95em;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                padding-top: 25px;
            ">
                Don't have an account? 
                <a href="#" onclick="hideSignInModal(); showSignUpModal(); return false;" style="
                    color: #667eea;
                    text-decoration: none;
                    font-weight: 700;
                    transition: all 0.3s ease;
                " onmouseover="this.style.color='#764ba2'; this.style.textDecoration='underline'" onmouseout="this.style.color='#667eea'; this.style.textDecoration='none'">
                    Create one now! ‚Üí
                </a>
            </p>
            
            <!-- Quick Stats Preview (if available) -->
            <div style="
                margin-top: 25px;
                padding: 20px;
                background: rgba(102, 126, 234, 0.1);
                border-radius: 12px;
                border: 1px solid rgba(102, 126, 234, 0.2);
                text-align: center;
            ">
                <div style="color: #aaa; font-size: 0.85em; margin-bottom: 8px;">üåü Active Players Today</div>
                <div style="color: #667eea; font-size: 1.8em; font-weight: 800;" id="active-players-count">---</div>
            </div>
        </div>
    </div>

    <!-- Account Modal -->
    <div id="account-modal" style="
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(10, 12, 15, 0.98);
        z-index: 3001;
        overflow-y: auto;
        padding: 0; margin: 0;
        backdrop-filter: blur(4px);
    ">
        <div style="
            max-width: 1200px;
            width: 97vw;
            margin: 20px auto;
            background: #1a1e26;
            border-radius: 20px;
            box-shadow: 0 10px 50px #0009;
            padding: 0;
            color: #fff;
            position: relative;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            overflow: hidden;
        ">
            <!-- Header with Close Button -->
            <div style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 28px 32px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 2px solid #667eea;
            ">
                <h2 style="margin: 0; font-size: 1.8em; color: #fff;">üë§ Player Hub</h2>
                <button onclick="hideAccountModal()" style="
                    background: rgba(255, 255, 255, 0.2);
                    color: white;
                    border: 2px solid rgba(255, 255, 255, 0.5);
                    border-radius: 50%;
                    font-size: 1.3em;
                    width: 40px;
                    height: 40px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                " onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">‚úñ</button>
            </div>

            <!-- Tab Navigation -->
            <div style="
                display: flex;
                background: #141820;
                border-bottom: 2px solid #2a2f3a;
                padding: 0;
                overflow-x: auto;
            ">
                <button onclick="switchAccountTab('overview')" class="account-tab-btn" style="
                    flex: 1;
                    padding: 16px 20px;
                    background: transparent;
                    border: none;
                    color: #999;
                    font-size: 0.95em;
                    font-weight: 600;
                    cursor: pointer;
                    border-bottom: 3px solid transparent;
                    transition: all 0.3s ease;
                    white-space: nowrap;
                " data-tab="overview" onmouseover="this.style.color='#fff'" onmouseout="this.style.color=this.classList.contains('active') ? '#fff' : '#999'">
                    üìä Overview
                </button>
                <button onclick="switchAccountTab('analytics')" class="account-tab-btn" style="
                    flex: 1;
                    padding: 16px 20px;
                    background: transparent;
                    border: none;
                    color: #999;
                    font-size: 0.95em;
                    font-weight: 600;
                    cursor: pointer;
                    border-bottom: 3px solid transparent;
                    transition: all 0.3s ease;
                    white-space: nowrap;
                " data-tab="analytics" onmouseover="this.style.color='#fff'" onmouseout="this.style.color=this.classList.contains('active') ? '#fff' : '#999'">
                    üìà Analytics
                </button>
                <button onclick="switchAccountTab('variations')" class="account-tab-btn" style="
                    flex: 1;
                    padding: 16px 20px;
                    background: transparent;
                    border: none;
                    color: #999;
                    font-size: 0.95em;
                    font-weight: 600;
                    cursor: pointer;
                    border-bottom: 3px solid transparent;
                    transition: all 0.3s ease;
                    white-space: nowrap;
                " data-tab="variations" onmouseover="this.style.color='#fff'" onmouseout="this.style.color=this.classList.contains('active') ? '#fff' : '#999'">
                    üéÆ Variations
                </button>
                <button onclick="switchAccountTab('achievements')" class="account-tab-btn" style="
                    flex: 1;
                    padding: 16px 20px;
                    background: transparent;
                    border: none;
                    color: #999;
                    font-size: 0.95em;
                    font-weight: 600;
                    cursor: pointer;
                    border-bottom: 3px solid transparent;
                    transition: all 0.3s ease;
                    white-space: nowrap;
                " data-tab="achievements" onmouseover="this.style.color='#fff'" onmouseout="this.style.color=this.classList.contains('active') ? '#fff' : '#999'">
                    üèÜ Achievements
                </button>
                <button onclick="switchAccountTab('ratings')" class="account-tab-btn" style="
                    flex: 1;
                    padding: 16px 20px;
                    background: transparent;
                    border: none;
                    color: #999;
                    font-size: 0.95em;
                    font-weight: 600;
                    cursor: pointer;
                    border-bottom: 3px solid transparent;
                    transition: all 0.3s ease;
                    white-space: nowrap;
                " data-tab="ratings" onmouseover="this.style.color='#fff'" onmouseout="this.style.color=this.classList.contains('active') ? '#fff' : '#999'">
                    ‚≠ê Ratings
                </button>
                <button onclick="switchAccountTab('settings')" class="account-tab-btn" style="
                    flex: 1;
                    padding: 16px 20px;
                    background: transparent;
                    border: none;
                    color: #999;
                    font-size: 0.95em;
                    font-weight: 600;
                    cursor: pointer;
                    border-bottom: 3px solid transparent;
                    transition: all 0.3s ease;
                    white-space: nowrap;
                " data-tab="settings" onmouseover="this.style.color='#fff'" onmouseout="this.style.color=this.classList.contains('active') ? '#fff' : '#999'">
                    ‚öôÔ∏è Settings
                </button>
            </div>

            <!-- Main Content Area -->
            <div style="
                flex: 1;
                padding: 32px;
                display: flex;
                gap: 32px;
                overflow-y: auto;
            ">
                <!-- Sidebar -->
                <div style="
                    min-width: 280px;
                    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
                    padding: 24px;
                    border-radius: 16px;
                    border: 1px solid rgba(102, 126, 234, 0.3);
                    height: fit-content;
                ">
                    <div style="text-align: center; margin-bottom: 24px;">
                        <div id="account-avatar" style="
                            width: 120px;
                            height: 120px;
                            border-radius: 50%;
                            background: rgba(255, 255, 255, 0.1);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            margin: 0 auto 16px;
                            font-size: 3em;
                            border: 4px solid rgba(102, 126, 234, 0.6);
                            overflow: hidden;
                        ">üë§</div>
                        <h3 id="account-sidebar-name" style="
                            margin: 0 0 8px 0;
                            font-size: 1.3em;
                            color: #fff;
                            word-break: break-word;
                        ">Guest Player</h3>
                        <p id="account-sidebar-email" style="
                            margin: 0 0 16px 0;
                            color: #999;
                            font-size: 0.85em;
                            word-break: break-all;
                        ">Session User</p>
                    </div>
                    
                    <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 16px;">
                        <div style="margin-bottom: 16px;">
                            <p style="color: #999; font-size: 0.85em; margin: 0 0 4px 0;">Registered</p>
                            <p id="account-sidebar-date" style="color: #4ecdc4; font-weight: 600; margin: 0;">Not registered</p>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <p style="color: #999; font-size: 0.85em; margin: 0 0 4px 0;">Member Level</p>
                            <p id="account-member-level" style="color: #ffd700; font-weight: 600; margin: 0;">Bronze</p>
                        </div>
                        <div>
                            <p style="color: #999; font-size: 0.85em; margin: 0 0 4px 0;">Total Games</p>
                            <p id="account-total-games" style="color: #4ecdc4; font-weight: 600; margin: 0; font-size: 1.3em;">0</p>
                        </div>
                    </div>
                </div>

                <!-- Main Tab Content -->
                <div style="flex: 1; overflow-y: auto;">
                    
                    <!-- OVERVIEW TAB -->
                    <div id="account-tab-overview" class="account-tab-content" style="display: block;">
                        <h3 style="color: #667eea; margin-top: 0; margin-bottom: 24px; font-size: 1.4em;">Profile & Quick Stats</h3>
                        
                        <!-- Profile Info -->
                        <div style="
                            background: rgba(78, 205, 196, 0.1);
                            padding: 20px;
                            border-radius: 12px;
                            border-left: 4px solid #4ecdc4;
                            margin-bottom: 24px;
                        ">
                            <p style="color: #aaa; margin: 8px 0;"><strong style="color: #4ecdc4;">Username:</strong> <span id="account-username">Loading...</span></p>
                            <p style="color: #aaa; margin: 8px 0;"><strong style="color: #4ecdc4;">Email:</strong> <span id="account-email">Loading...</span></p>
                        </div>

                        <!-- Quick Stats Grid -->
                        <div style="margin-bottom: 24px;">
                            <h4 style="color: #999; margin: 0 0 16px 0; font-size: 0.95em; text-transform: uppercase; letter-spacing: 1px;">Game Record</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 12px;">
                                <div style="
                                    background: linear-gradient(135deg, rgba(38, 222, 129, 0.1) 0%, rgba(38, 222, 129, 0.05) 100%);
                                    padding: 18px;
                                    border-radius: 10px;
                                    border: 1px solid rgba(38, 222, 129, 0.3);
                                    text-align: center;
                                ">
                                    <div style="color: #26de81; font-size: 2em; font-weight: bold;" id="account-wins">0</div>
                                    <div style="color: #999; font-size: 0.85em; margin-top: 6px;">Wins</div>
                                </div>
                                <div style="
                                    background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(255, 107, 107, 0.05) 100%);
                                    padding: 18px;
                                    border-radius: 10px;
                                    border: 1px solid rgba(255, 107, 107, 0.3);
                                    text-align: center;
                                ">
                                    <div style="color: #ff6b6b; font-size: 2em; font-weight: bold;" id="account-losses">0</div>
                                    <div style="color: #999; font-size: 0.85em; margin-top: 6px;">Losses</div>
                                </div>
                                <div style="
                                    background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%);
                                    padding: 18px;
                                    border-radius: 10px;
                                    border: 1px solid rgba(255, 215, 0, 0.3);
                                    text-align: center;
                                ">
                                    <div style="color: #ffd700; font-size: 2em; font-weight: bold;" id="account-winrate">0%</div>
                                    <div style="color: #999; font-size: 0.85em; margin-top: 6px;">Win Rate</div>
                                </div>
                                <div style="
                                    background: linear-gradient(135deg, rgba(78, 205, 196, 0.1) 0%, rgba(78, 205, 196, 0.05) 100%);
                                    padding: 18px;
                                    border-radius: 10px;
                                    border: 1px solid rgba(78, 205, 196, 0.3);
                                    text-align: center;
                                ">
                                    <div style="color: #4ecdc4; font-size: 2em; font-weight: bold;" id="account-games">0</div>
                                    <div style="color: #999; font-size: 0.85em; margin-top: 6px;">Total</div>
                                </div>
                            </div>
                        </div>

                        <!-- Account Activity -->
                        <div style="
                            background: rgba(165, 94, 234, 0.1);
                            padding: 20px;
                            border-radius: 12px;
                            border-left: 4px solid #a55eea;
                            margin-bottom: 24px;
                        ">
                            <h4 style="color: #a55eea; margin: 0 0 12px 0;">üìÖ Activity</h4>
                            <p style="color: #aaa; margin: 8px 0;"><strong style="color: #a55eea;">Last Login:</strong> <span id="account-last-login">Never</span></p>
                            <p style="color: #aaa; margin: 8px 0;"><strong style="color: #a55eea;">Saved Games:</strong> <span id="account-saved-games">0</span></p>
                            <p style="color: #aaa; margin: 8px 0;"><strong style="color: #a55eea;">Total Moves Made:</strong> <span id="account-total-moves">0</span></p>
                            <p style="color: #aaa; margin: 8px 0;"><strong style="color: #a55eea;">Pieces Captured:</strong> <span id="account-total-captures">0</span></p>
                        </div>

                        <!-- Delete Account -->
                        <button onclick="deleteAccount()" style="
                            width: 100%;
                            background: linear-gradient(135deg, #ff6b6b, #ff8a8a);
                            color: white;
                            border: none;
                            padding: 14px 24px;
                            border-radius: 10px;
                            font-weight: 700;
                            font-size: 0.95em;
                            cursor: pointer;
                            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(255, 107, 107, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255, 107, 107, 0.3)'">
                            üóëÔ∏è Delete Account
                        </button>
                    </div>

                    <!-- ANALYTICS TAB -->
                    <div id="account-tab-analytics" class="account-tab-content" style="display: none;">
                        <h3 style="color: #667eea; margin-top: 0; margin-bottom: 24px; font-size: 1.4em;">Performance Analytics</h3>
                        
                        <!-- Win/Loss Trend -->
                        <div style="
                            background: rgba(102, 126, 234, 0.1);
                            padding: 20px;
                            border-radius: 12px;
                            border-left: 4px solid #667eea;
                            margin-bottom: 24px;
                        ">
                            <h4 style="color: #667eea; margin: 0 0 16px 0;">üéØ Performance</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div>
                                    <p style="color: #999; font-size: 0.9em; margin: 0 0 8px 0;">Avg Moves per Game</p>
                                    <p style="color: #667eea; font-size: 1.6em; font-weight: bold; margin: 0;" id="account-avg-moves">0</p>
                                </div>
                                <div>
                                    <p style="color: #999; font-size: 0.9em; margin: 0 0 8px 0;">Fastest Win</p>
                                    <p style="color: #667eea; font-size: 1.6em; font-weight: bold; margin: 0;" id="account-fastest-win">‚Äî</p>
                                </div>
                            </div>
                        </div>

                        <!-- Piece Performance -->
                        <div style="
                            background: rgba(78, 205, 196, 0.1);
                            padding: 20px;
                            border-radius: 12px;
                            border-left: 4px solid #4ecdc4;
                            margin-bottom: 24px;
                        ">
                            <h4 style="color: #4ecdc4; margin: 0 0 16px 0;">‚ôüÔ∏è Piece Usage</h4>
                            <div style="overflow-x: auto;">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead style="border-bottom: 2px solid #4ecdc4;">
                                        <tr style="color: #999; font-size: 0.9em;">
                                            <th style="text-align: left; padding: 12px 8px;">Piece</th>
                                            <th style="text-align: center; padding: 12px 8px;">Captures</th>
                                            <th style="text-align: center; padding: 12px 8px;">Survived</th>
                                            <th style="text-align: center; padding: 12px 8px;">Lost</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="border-bottom: 1px solid rgba(78, 205, 196, 0.2); color: #ccc; font-size: 0.95em;">
                                            <td style="padding: 12px 8px;">üü¶ Square</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-square-captures">0</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-square-survived">0</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-square-lost">0</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid rgba(78, 205, 196, 0.2); color: #ccc; font-size: 0.95em;">
                                            <td style="padding: 12px 8px;">üî∫ Triangle</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-triangle-captures">0</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-triangle-survived">0</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-triangle-lost">0</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid rgba(78, 205, 196, 0.2); color: #ccc; font-size: 0.95em;">
                                            <td style="padding: 12px 8px;">‚ô¶Ô∏è Rhombus</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-rhombus-captures">0</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-rhombus-survived">0</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-rhombus-lost">0</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid rgba(78, 205, 196, 0.2); color: #ccc; font-size: 0.95em;">
                                            <td style="padding: 12px 8px;">‚óè Circle</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-circle-captures">0</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-circle-survived">0</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-circle-lost">0</td>
                                        </tr>
                                        <tr style="color: #ccc; font-size: 0.95em;">
                                            <td style="padding: 12px 8px;">‚¨° Hexagon</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-hexagon-captures">0</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-hexagon-survived">0</td>
                                            <td style="text-align: center; padding: 12px 8px;" id="piece-hexagon-lost">0</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Personal Records -->
                        <div style="
                            background: rgba(165, 94, 234, 0.1);
                            padding: 20px;
                            border-radius: 12px;
                            border-left: 4px solid #a55eea;
                        ">
                            <h4 style="color: #a55eea; margin: 0 0 16px 0;">üèÖ Personal Records</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div>
                                    <p style="color: #999; font-size: 0.9em; margin: 0 0 8px 0;">Win Streak</p>
                                    <p style="color: #a55eea; font-size: 1.6em; font-weight: bold; margin: 0;" id="account-win-streak">0</p>
                                </div>
                                <div>
                                    <p style="color: #999; font-size: 0.9em; margin: 0 0 8px 0;">Total Captures</p>
                                    <p style="color: #a55eea; font-size: 1.6em; font-weight: bold; margin: 0;" id="account-captures">0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VARIATIONS TAB -->
                    <div id="account-tab-variations" class="account-tab-content" style="display: none;">
                        <h3 style="color: #667eea; margin-top: 0; margin-bottom: 24px; font-size: 1.4em;">Game Variations</h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <!-- Standard Romgon -->
                            <div style="
                                background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(102, 126, 234, 0.05) 100%);
                                padding: 24px;
                                border-radius: 14px;
                                border: 2px solid #667eea;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(102, 126, 234, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <h4 style="color: #667eea; margin: 0 0 12px 0; font-size: 1.3em;">üéÆ Standard Romgon</h4>
                                <p style="color: #999; margin: 0 0 16px 0; font-size: 0.95em;">Classic ruleset. All pieces defend the base. Compete at the highest level.</p>
                                <ul style="color: #aaa; font-size: 0.9em; margin: 12px 0; padding-left: 20px;">
                                    <li>All 7 pieces per player</li>
                                    <li>Bases defend equally</li>
                                    <li>Standard capture rules</li>
                                </ul>
                                <button onclick="startGameWithVariant('standard')" style="
                                    width: 100%;
                                    background: linear-gradient(135deg, #667eea, #764ba2);
                                    color: white;
                                    border: none;
                                    padding: 12px 20px;
                                    border-radius: 8px;
                                    font-weight: 600;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                    margin-top: 16px;
                                " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">Play Now</button>
                            </div>

                            <!-- Shapes Defense Variant -->
                            <div style="
                                background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(255, 107, 107, 0.05) 100%);
                                padding: 24px;
                                border-radius: 14px;
                                border: 2px solid #ff6b6b;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(255, 107, 107, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <h4 style="color: #ff6b6b; margin: 0 0 12px 0; font-size: 1.3em;">üõ°Ô∏è Shapes Defense</h4>
                                <p style="color: #999; margin: 0 0 16px 0; font-size: 0.95em;">Stronger piece-based defense. All pieces can defend your base against invaders.</p>
                                <ul style="color: #aaa; font-size: 0.9em; margin: 12px 0; padding-left: 20px;">
                                    <li>Enhanced defense mechanics</li>
                                    <li>Piece-based fortress building</li>
                                    <li>Strategic depth</li>
                                </ul>
                                <button onclick="startGameWithVariant('shapeDefense')" style="
                                    width: 100%;
                                    background: linear-gradient(135deg, #ff6b6b, #ff8a8a);
                                    color: white;
                                    border: none;
                                    padding: 12px 20px;
                                    border-radius: 8px;
                                    font-weight: 600;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                    margin-top: 16px;
                                " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">Play Now</button>
                            </div>

                            <!-- Rhombus Original -->
                            <div style="
                                background: linear-gradient(135deg, rgba(4, 206, 180, 0.1) 0%, rgba(4, 206, 180, 0.05) 100%);
                                padding: 24px;
                                border-radius: 14px;
                                border: 2px solid #04ceb4;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(4, 206, 180, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <h4 style="color: #04ceb4; margin: 0 0 12px 0; font-size: 1.3em;">‚ô¶Ô∏è Rhombus Original</h4>
                                <p style="color: #999; margin: 0 0 16px 0; font-size: 0.95em;">Only rhombuses can defend. Fast-paced endgames. For master-level play.</p>
                                <ul style="color: #aaa; font-size: 0.9em; margin: 12px 0; padding-left: 20px;">
                                    <li>Rhombus-only defense</li>
                                    <li>Intense endgames</li>
                                    <li>High-risk gameplay</li>
                                </ul>
                                <button onclick="startGameWithVariant('rhombusOriginal')" style="
                                    width: 100%;
                                    background: linear-gradient(135deg, #04ceb4, #12d8d8);
                                    color: white;
                                    border: none;
                                    padding: 12px 20px;
                                    border-radius: 8px;
                                    font-weight: 600;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                    margin-top: 16px;
                                " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">Play Now</button>
                            </div>

                            <!-- Fortress Variant -->
                            <div style="
                                background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%);
                                padding: 24px;
                                border-radius: 14px;
                                border: 2px solid #ffd700;
                                cursor: pointer;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(255, 215, 0, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <h4 style="color: #ffd700; margin: 0 0 12px 0; font-size: 1.3em;">üè∞ Fortress</h4>
                                <p style="color: #999; margin: 0 0 16px 0; font-size: 0.95em;">Enhanced defense with fortress mechanics. Build and maintain impenetrable bases.</p>
                                <ul style="color: #aaa; font-size: 0.9em; margin: 12px 0; padding-left: 20px;">
                                    <li>Fortress zones</li>
                                    <li>Enhanced defenses</li>
                                    <li>Longer games</li>
                                </ul>
                                <button onclick="startGameWithVariant('fortress')" style="
                                    width: 100%;
                                    background: linear-gradient(135deg, #ffd700, #ffed4e);
                                    color: #1a1a1a;
                                    border: none;
                                    padding: 12px 20px;
                                    border-radius: 8px;
                                    font-weight: 600;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                    margin-top: 16px;
                                " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">Play Now</button>
                            </div>
                        </div>
                    </div>

                    <!-- ACHIEVEMENTS TAB -->
                    <div id="account-tab-achievements" class="account-tab-content" style="display: none;">
                        <h3 style="color: #667eea; margin-top: 0; margin-bottom: 24px; font-size: 1.4em;">üèÜ Achievements & Badges</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 16px;">
                            <div style="
                                background: rgba(102, 126, 234, 0.1);
                                padding: 20px;
                                border-radius: 12px;
                                text-align: center;
                                border: 2px solid #667eea;
                                opacity: 0.7;
                            ">
                                <div style="font-size: 2.5em; margin-bottom: 8px;">üî∞</div>
                                <p style="color: #999; font-size: 0.85em; margin: 0;">First Game</p>
                                <p style="color: #667eea; font-size: 0.8em; margin: 8px 0 0 0;">Locked</p>
                            </div>
                            <div style="
                                background: rgba(38, 222, 129, 0.1);
                                padding: 20px;
                                border-radius: 12px;
                                text-align: center;
                                border: 2px solid #26de81;
                            ">
                                <div style="font-size: 2.5em; margin-bottom: 8px;">ü•á</div>
                                <p style="color: #999; font-size: 0.85em; margin: 0;">First Win</p>
                                <p style="color: #26de81; font-size: 0.8em; margin: 8px 0 0 0;">Unlocked</p>
                            </div>
                            <div style="
                                background: rgba(255, 215, 0, 0.1);
                                padding: 20px;
                                border-radius: 12px;
                                text-align: center;
                                border: 2px solid #ffd700;
                                opacity: 0.7;
                            ">
                                <div style="font-size: 2.5em; margin-bottom: 8px;">‚≠ê</div>
                                <p style="color: #999; font-size: 0.85em; margin: 0;">10-Win Streak</p>
                                <p style="color: #ffd700; font-size: 0.8em; margin: 8px 0 0 0;">Locked</p>
                            </div>
                            <div style="
                                background: rgba(78, 205, 196, 0.1);
                                padding: 20px;
                                border-radius: 12px;
                                text-align: center;
                                border: 2px solid #4ecdc4;
                                opacity: 0.7;
                            ">
                                <div style="font-size: 2.5em; margin-bottom: 8px;">üéØ</div>
                                <p style="color: #999; font-size: 0.85em; margin: 0;">Master Tactician</p>
                                <p style="color: #4ecdc4; font-size: 0.8em; margin: 8px 0 0 0;">Locked</p>
                            </div>
                            <div style="
                                background: rgba(165, 94, 234, 0.1);
                                padding: 20px;
                                border-radius: 12px;
                                text-align: center;
                                border: 2px solid #a55eea;
                                opacity: 0.7;
                            ">
                                <div style="font-size: 2.5em; margin-bottom: 8px;">üëë</div>
                                <p style="color: #999; font-size: 0.85em; margin: 0;">Champion</p>
                                <p style="color: #a55eea; font-size: 0.8em; margin: 8px 0 0 0;">Locked</p>
                            </div>
                        </div>

                        <div style="
                            margin-top: 32px;
                            background: rgba(102, 126, 234, 0.1);
                            padding: 24px;
                            border-radius: 12px;
                            border-left: 4px solid #667eea;
                        ">
                            <h4 style="color: #667eea; margin: 0 0 16px 0;">üìà Progress</h4>
                            <p style="color: #aaa; margin: 0 0 12px 0;">1 of 5 achievements unlocked (20%)</p>
                            <div style="
                                background: rgba(0, 0, 0, 0.3);
                                height: 8px;
                                border-radius: 4px;
                                overflow: hidden;
                            ">
                                <div style="
                                    background: linear-gradient(90deg, #667eea, #764ba2);
                                    height: 100%;
                                    width: 20%;
                                    transition: width 0.3s ease;
                                "></div>
                            </div>
                        </div>
                    </div>

                    <!-- RATINGS TAB -->
                    <div id="account-tab-ratings" class="account-tab-content" style="display: none;">
                        <h3 style="color: #f39c12; margin-top: 0; margin-bottom: 24px; font-size: 1.4em;">‚≠ê Rating & Skill Progression</h3>
                        
                        <!-- Current Rating Section -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 32px;">
                            <!-- Rating Card -->
                            <div style="
                                background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(41, 128, 185, 0.1));
                                padding: 24px;
                                border-radius: 12px;
                                border: 2px solid #f39c12;
                            ">
                                <p style="color: #999; font-size: 0.85em; margin: 0 0 12px 0; font-weight: 600;">CURRENT RATING</p>
                                <div style="font-size: 2.5em; font-weight: bold; color: #f39c12; margin-bottom: 8px;" id="hub-current-rating">1600</div>
                                <div style="font-size: 1.1em; color: #4ecdc4; font-weight: bold;" id="hub-rating-tier">ü•à Intermediate</div>
                            </div>

                            <!-- Stats Card -->
                            <div style="
                                background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(78, 205, 196, 0.1));
                                padding: 24px;
                                border-radius: 12px;
                                border: 2px solid #27ae60;
                            ">
                                <p style="color: #999; font-size: 0.85em; margin: 0 0 12px 0; font-weight: 600;">RATING STATS</p>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <div>
                                        <p style="color: #999; font-size: 0.8em; margin: 0;">Games</p>
                                        <p style="color: #27ae60; font-size: 1.5em; font-weight: bold; margin: 0;" id="hub-rating-games">0</p>
                                    </div>
                                    <div>
                                        <p style="color: #999; font-size: 0.8em; margin: 0;">Changes</p>
                                        <p style="color: #4ecdc4; font-size: 1.5em; font-weight: bold; margin: 0;" id="hub-rating-changes">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Rating Tier Guide -->
                        <div style="
                            background: rgba(243, 156, 18, 0.1);
                            padding: 24px;
                            border-radius: 12px;
                            border-left: 4px solid #f39c12;
                            margin-bottom: 32px;
                        ">
                            <h4 style="color: #f39c12; margin: 0 0 16px 0; font-size: 1.1em;">üìä Rating Tiers</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                                <div style="background: rgba(255, 215, 0, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #FFD700;">
                                    <p style="color: #FFD700; font-weight: bold; margin: 0; font-size: 0.9em;">üëë Grandmaster</p>
                                    <p style="color: #999; margin: 0; font-size: 0.8em;">2400+</p>
                                </div>
                                <div style="background: rgba(255, 105, 180, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #FF69B4;">
                                    <p style="color: #FF69B4; font-weight: bold; margin: 0; font-size: 0.9em;">üèÜ Master</p>
                                    <p style="color: #999; margin: 0; font-size: 0.8em;">2200-2399</p>
                                </div>
                                <div style="background: rgba(255, 107, 107, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #FF6B6B;">
                                    <p style="color: #FF6B6B; font-weight: bold; margin: 0; font-size: 0.9em;">‚≠ê Expert</p>
                                    <p style="color: #999; margin: 0; font-size: 0.8em;">2000-2199</p>
                                </div>
                                <div style="background: rgba(243, 156, 18, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #F39C12;">
                                    <p style="color: #F39C12; font-weight: bold; margin: 0; font-size: 0.9em;">ü•á Advanced</p>
                                    <p style="color: #999; margin: 0; font-size: 0.8em;">1800-1999</p>
                                </div>
                                <div style="background: rgba(78, 205, 196, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #4ecdc4;">
                                    <p style="color: #4ecdc4; font-weight: bold; margin: 0; font-size: 0.9em;">ü•à Intermediate</p>
                                    <p style="color: #999; margin: 0; font-size: 0.8em;">1600-1799</p>
                                </div>
                                <div style="background: rgba(39, 174, 96, 0.1); padding: 12px; border-radius: 8px; border-left: 3px solid #27ae60;">
                                    <p style="color: #27ae60; font-weight: bold; margin: 0; font-size: 0.9em;">ü•â Beginner</p>
                                    <p style="color: #999; margin: 0; font-size: 0.8em;">1400-1599</p>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Rating Changes -->
                        <div style="
                            background: rgba(78, 205, 196, 0.1);
                            padding: 24px;
                            border-radius: 12px;
                            border-left: 4px solid #4ecdc4;
                        ">
                            <h4 style="color: #4ecdc4; margin: 0 0 16px 0; font-size: 1.1em;">üìà Recent Rating Changes</h4>
                            <div id="hub-rating-history" style="display: flex; flex-direction: column; gap: 12px; max-height: 300px; overflow-y: auto;">
                                <p style="color: #999; text-align: center; padding: 20px;">No rating changes yet. Play a game to start!</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- SETTINGS TAB -->
                    <div id="account-tab-settings" class="account-tab-content" style="display: none;">
                        <h3 style="color: #667eea; margin-top: 0; margin-bottom: 24px; font-size: 1.4em;">‚öôÔ∏è Profile Settings</h3>
                        
                        <!-- Display Name Section -->
                        <div style="
                            background: rgba(102, 126, 234, 0.1);
                            padding: 24px;
                            border-radius: 12px;
                            border-left: 4px solid #667eea;
                            margin-bottom: 24px;
                        ">
                            <h4 style="color: #667eea; margin: 0 0 16px 0; font-size: 1.1em;">‚úèÔ∏è Display Name</h4>
                            <div style="display: flex; gap: 12px; align-items: flex-start;">
                                <input type="text" id="hub-username-input" placeholder="Enter new username" style="
                                    flex: 1;
                                    padding: 12px 16px;
                                    background: #1a1e26;
                                    border: 2px solid #667eea;
                                    border-radius: 8px;
                                    color: #fff;
                                    font-size: 1em;
                                " />
                                <button onclick="saveUsername()" style="
                                    background: linear-gradient(135deg, #667eea, #764ba2);
                                    color: white;
                                    border: none;
                                    padding: 12px 24px;
                                    border-radius: 8px;
                                    cursor: pointer;
                                    font-weight: 600;
                                    transition: all 0.3s;
                                " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                    Save
                                </button>
                            </div>
                            <p style="color: #999; font-size: 0.85em; margin: 8px 0 0 0;">This is how other players will see you</p>
                        </div>
                        
                        <!-- Avatar Selection -->
                        <div style="
                            background: rgba(78, 205, 196, 0.1);
                            padding: 24px;
                            border-radius: 12px;
                            border-left: 4px solid #4ecdc4;
                            margin-bottom: 24px;
                        ">
                            <h4 style="color: #4ecdc4; margin: 0 0 16px 0; font-size: 1.1em;">üé® Avatar</h4>
                            
                            <!-- Custom Avatar Upload -->
                            <div style="margin-bottom: 20px; padding: 16px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 12px;">
                                    <div id="avatar-preview" style="
                                        width: 80px;
                                        height: 80px;
                                        border-radius: 50%;
                                        background: #1a1e26;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        font-size: 40px;
                                        border: 3px solid #4ecdc4;
                                        overflow: hidden;
                                    ">
                                        üòÄ
                                    </div>
                                    <div style="flex: 1;">
                                        <input type="file" id="avatar-file-input" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)" />
                                        <button onclick="document.getElementById('avatar-file-input').click()" style="
                                            background: linear-gradient(135deg, #4ecdc4, #44a3a0);
                                            color: white;
                                            border: none;
                                            padding: 12px 24px;
                                            border-radius: 8px;
                                            cursor: pointer;
                                            font-weight: 600;
                                            transition: all 0.3s;
                                            width: 100%;
                                        " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                            üì§ Upload Your Picture
                                        </button>
                                        <p style="color: #999; font-size: 0.85em; margin: 8px 0 0 0;">Max 2MB ‚Ä¢ JPG, PNG, GIF</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Emoji Avatars -->
                            <div style="margin-bottom: 12px;">
                                <h5 style="color: #4ecdc4; margin: 0 0 12px 0; font-size: 0.95em;">Or choose an emoji:</h5>
                            </div>
                            <div id="avatar-grid" style="
                                display: grid;
                                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                                gap: 12px;
                                margin-bottom: 16px;
                            ">
                                <!-- Avatar options will be populated here -->
                            </div>
                            <p style="color: #999; font-size: 0.85em; margin: 0;">Click an avatar to select it</p>
                        </div>
                        
                        <!-- Badge Selection -->
                        <div style="
                            background: rgba(255, 215, 0, 0.1);
                            padding: 24px;
                            border-radius: 12px;
                            border-left: 4px solid #ffd700;
                            margin-bottom: 24px;
                        ">
                            <h4 style="color: #ffd700; margin: 0 0 16px 0; font-size: 1.1em;">üèÖ Badge</h4>
                            <div id="badge-grid" style="
                                display: grid;
                                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                                gap: 12px;
                                margin-bottom: 16px;
                            ">
                                <!-- Badge options will be populated here -->
                            </div>
                            <p style="color: #999; font-size: 0.85em; margin: 0;">Badges are earned through achievements and milestones</p>
                        </div>
                        
                        <!-- Account Actions -->
                        <div style="
                            background: rgba(255, 107, 107, 0.1);
                            padding: 24px;
                            border-radius: 12px;
                            border-left: 4px solid #ff6b6b;
                        ">
                            <h4 style="color: #ff6b6b; margin: 0 0 16px 0; font-size: 1.1em;">‚ö†Ô∏è Account Actions</h4>
                            <button onclick="confirmDeleteAccount()" style="
                                background: transparent;
                                color: #ff6b6b;
                                border: 2px solid #ff6b6b;
                                padding: 12px 24px;
                                border-radius: 8px;
                                cursor: pointer;
                                font-weight: 600;
                                transition: all 0.3s;
                            " onmouseover="this.style.background='rgba(255, 107, 107, 0.2)'" onmouseout="this.style.background='transparent'">
                                Delete Account
                            </button>
                            <p style="color: #999; font-size: 0.85em; margin: 8px 0 0 0;">This action cannot be undone</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Online Players Panel -->
    <div id="online-players-modal" style="
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(10, 12, 15, 0.98);
        z-index: 3001;
        overflow-y: auto;
        padding: 0; margin: 0;
        backdrop-filter: blur(4px);
    ">
        <div style="
            max-width: 800px;
            width: 95vw;
            margin: 30px auto;
            background: #1a1e26;
            border-radius: 20px;
            box-shadow: 0 10px 50px #0009;
            padding: 0;
            color: #fff;
            position: relative;
        ">
            <!-- Header -->
            <div style="
                background: linear-gradient(135deg, #26de81 0%, #20bf6b 100%);
                padding: 28px 32px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 2px solid #26de81;
                border-radius: 20px 20px 0 0;
            ">
                <div>
                    <h2 style="margin: 0; font-size: 1.8em; color: #fff;">üåê Online Players</h2>
                    <p id="online-players-count" style="margin: 5px 0 0 0; font-size: 0.9em; color: rgba(255,255,255,0.8);">Loading...</p>
                </div>
                <button onclick="closeOnlinePlayersPanel()" style="
                    background: rgba(255, 255, 255, 0.2);
                    color: white;
                    border: 2px solid rgba(255, 255, 255, 0.5);
                    border-radius: 50%;
                    font-size: 1.3em;
                    width: 40px;
                    height: 40px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                " onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">‚úñ</button>
            </div>

            <!-- Content -->
            <div style="padding: 24px 32px; max-height: 70vh; overflow-y: auto;">
                
                <!-- Search Box -->
                <div style="margin-bottom: 20px;">
                    <input type="text" id="player-search" placeholder="üîç Search players..." 
                        oninput="filterOnlinePlayers(this.value)"
                        style="
                        width: 100%;
                        padding: 12px 16px;
                        background: #2a2e36;
                        border: 2px solid #3a3e46;
                        border-radius: 10px;
                        color: white;
                        font-size: 0.95em;
                        box-sizing: border-box;
                    ">
                </div>

                <!-- Online Players List (Panel/Modal Context) -->
                <div id="online-players-panel-list" style="
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                ">
                    <!-- Players will be dynamically added here -->
                    <div style="text-align: center; color: #999; padding: 40px 20px;">
                        <div style="font-size: 3em; margin-bottom: 15px;">üë•</div>
                        <p>Connecting to server...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Panel Modal -->
    <div id="chat-panel-modal" onclick="console.log('üü† MODAL BACKGROUND CLICKED');" style="
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(10, 12, 15, 0.98);
        z-index: 1000000;
        overflow: hidden;
        backdrop-filter: blur(4px);
    ">
        <div onclick="event.stopPropagation(); console.log('üü£ INNER PANEL CLICKED');" style="
            max-width: 900px;
            width: 95vw;
            height: 85vh;
            margin: 40px auto;
            background: #1a1e26;
            border-radius: 20px;
            box-shadow: 0 10px 50px #0009;
            color: #fff;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        ">
            <!-- Header -->
            <div style="
                background: linear-gradient(135deg, #4ecdc4 0%, #44a3a3 100%);
                padding: 20px 28px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 2px solid #4ecdc4;
            ">
                <div>
                    <h2 style="margin: 0; font-size: 1.6em; color: #fff;">üí¨ Direct Messages</h2>
                    <p style="margin: 5px 0 0 0; font-size: 0.85em; color: rgba(255,255,255,0.8);">Chat with online players</p>
                </div>
                <button onclick="console.log('‚ùå‚ùå‚ùå CLOSE BUTTON CLICKED ‚ùå‚ùå‚ùå'); closeChatPanel();" style="
                    background: rgba(255, 255, 255, 0.2);
                    color: white;
                    border: 2px solid rgba(255, 255, 255, 0.5);
                    border-radius: 50%;
                    font-size: 1.2em;
                    width: 38px;
                    height: 38px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                " onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">‚úñ</button>
            </div>

            <!-- Chat Content: Split Layout -->
            <div style="display: flex; flex: 1; overflow: hidden;">
                
                <!-- Conversations List (Left Sidebar) -->
                <div style="
                    width: 280px;
                    background: #23272e;
                    border-right: 2px solid #2a2e36;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                ">
                    <div style="padding: 16px; border-bottom: 2px solid #2a2e36;">
                        <h3 style="margin: 0; font-size: 0.95em; color: #aaa; text-transform: uppercase; letter-spacing: 1px;">Conversations</h3>
                    </div>
                    <div id="conversations-list" style="flex: 1; overflow-y: auto; padding: 8px;">
                        <div style="text-align: center; color: #666; padding: 40px 20px; font-size: 0.9em;">
                            <p>üí¨</p>
                            <p>No conversations yet</p>
                            <p style="font-size: 0.85em; margin-top: 10px;">Send a message to start chatting!</p>
                        </div>
                    </div>
                </div>

                <!-- Active Chat (Right Panel) -->
                <div id="active-chat-panel" style="
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                ">
                    <!-- No conversation selected -->
                    <div id="no-chat-selected" style="
                        flex: 1;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        flex-direction: column;
                        color: #666;
                        gap: 12px;
                    ">
                        <div style="font-size: 4em;">üí¨</div>
                        <p style="font-size: 1.1em;">Select a conversation</p>
                        <p style="font-size: 0.9em;">or send a message from the Online Players list</p>
                    </div>

                    <!-- Active chat (hidden by default) -->
                    <div id="active-chat-container" style="display: none; flex-direction: column; height: 100%;">
                        <!-- Chat header -->
                        <div id="active-chat-header" style="
                            padding: 16px 20px;
                            background: #23272e;
                            border-bottom: 2px solid #2a2e36;
                            display: flex;
                            align-items: center;
                            gap: 12px;
                        ">
                            <div style="
                                width: 40px;
                                height: 40px;
                                border-radius: 50%;
                                background: linear-gradient(135deg, #4ecdc4, #44a3a3);
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 1.5em;
                            " id="active-chat-avatar">üë§</div>
                            <div>
                                <div id="active-chat-name" style="font-weight: 600; font-size: 1.05em;">User</div>
                                <div id="active-chat-status" style="font-size: 0.8em; color: #26de81;">‚óè Online</div>
                            </div>
                        </div>

                        <!-- Messages area -->
                        <div id="chat-messages-area" style="
                            flex: 1;
                            overflow-y: auto;
                            padding: 20px;
                            background: #1a1e26;
                            display: flex;
                            flex-direction: column;
                            gap: 12px;
                        ">
                            <!-- Messages will be added here -->
                        </div>

                        <!-- Message input -->
                        <div style="
                            padding: 16px 20px;
                            background: #23272e;
                            border-top: 2px solid #2a2e36;
                            display: flex;
                            gap: 12px;
                            align-items: center;
                        ">
                            <input type="text" id="chat-message-input" placeholder="Type a message..." 
                                onclick="console.log('üü° INPUT CLICKED');"
                                onfocus="console.log('üü° INPUT FOCUSED');"
                                onkeypress="console.log('üü¢ KEY PRESSED:', event.key); if(event.key==='Enter') { console.log('üü¢ ENTER PRESSED'); sendChatMessage(); }"
                                style="
                                flex: 1;
                                padding: 12px 16px;
                                background: #2a2e36;
                                border: 2px solid #3a3e46;
                                border-radius: 12px;
                                color: white;
                                font-size: 0.95em;
                            ">
                            <button onclick="console.log('üî¥ BUTTON CLICKED'); sendChatMessage();" style="
                                background: linear-gradient(135deg, #4ecdc4 0%, #44a3a3 100%);
                                color: white;
                                border: none;
                                padding: 12px 24px;
                                border-radius: 12px;
                                cursor: pointer;
                                font-weight: 600;
                                font-size: 0.95em;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" style="
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(20, 24, 32, 0.98);
        z-index: 3001;
        overflow-y: auto;
        padding: 0; margin: 0;
        backdrop-filter: blur(4px);
    ">
        <div style="
            max-width: 600px;
            margin: 60px auto;
            background: #23272e;
            border-radius: 18px;
            box-shadow: 0 8px 40px #000a;
            padding: 40px 36px;
            color: #fff;
            position: relative;
        ">
            <button onclick="hideSettingsModal()" style="
                position: absolute; top: 18px; right: 18px;
                background: #a55eea; color: #23272e;
                border: none; border-radius: 8px;
                font-size: 1.2em; font-weight: bold;
                padding: 6px 16px; cursor: pointer; z-index: 10;
                transition: all 0.3s ease;
            " onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">‚úñÔ∏è</button>
            
            <h2 style="color: #a55eea; margin-top: 0; text-align: center; font-size: 1.8em;">‚öôÔ∏è Preferences</h2>
            
            <!-- Tab Navigation -->
            <div style="display: flex; gap: 8px; margin: 20px 0; border-bottom: 2px solid #333; flex-wrap: wrap;">
                <button onclick="switchPrefsTab('general')" id="tab-general" class="pref-tab active-tab" style="
                    background: transparent; border: none; color: #fff; padding: 12px 20px;
                    cursor: pointer; font-weight: 600; border-bottom: 3px solid #a55eea;
                    transition: all 0.3s;
                ">üéÆ General</button>
                <button onclick="switchPrefsTab('gameplay')" id="tab-gameplay" class="pref-tab" style="
                    background: transparent; border: none; color: #888; padding: 12px 20px;
                    cursor: pointer; font-weight: 600; border-bottom: 3px solid transparent;
                    transition: all 0.3s;
                ">‚ôüÔ∏è Gameplay</button>
                <button onclick="switchPrefsTab('lobby')" id="tab-lobby" class="pref-tab" style="
                    background: transparent; border: none; color: #888; padding: 12px 20px;
                    cursor: pointer; font-weight: 600; border-bottom: 3px solid transparent;
                    transition: all 0.3s;
                ">üè† Lobby</button>
                <button onclick="switchPrefsTab('custom-games')" id="tab-custom-games" class="pref-tab" style="
                    background: transparent; border: none; color: #888; padding: 12px 20px;
                    cursor: pointer; font-weight: 600; border-bottom: 3px solid transparent;
                    transition: all 0.3s;
                ">üé® Custom Games</button>
                <button onclick="switchPrefsTab('game-creator')" id="tab-game-creator" class="pref-tab" style="
                    background: transparent; border: none; color: #888; padding: 12px 20px;
                    cursor: pointer; font-weight: 600; border-bottom: 3px solid transparent;
                    transition: all 0.3s;
                ">üõ†Ô∏è Game Creator</button>
                <button onclick="switchPrefsTab('engine')" id="tab-engine" class="pref-tab" style="
                    background: transparent; border: none; color: #888; padding: 12px 20px;
                    cursor: pointer; font-weight: 600; border-bottom: 3px solid transparent;
                    transition: all 0.3s;
                ">‚ö° Engine</button>
                <button onclick="switchPrefsTab('account')" id="tab-account" class="pref-tab" style="
                    background: transparent; border: none; color: #888; padding: 12px 20px;
                    cursor: pointer; font-weight: 600; border-bottom: 3px solid transparent;
                    transition: all 0.3s;
                ">üë§ Account</button>
                <button onclick="switchPrefsTab('advanced')" id="tab-advanced" class="pref-tab" style="
                    background: transparent; border: none; color: #888; padding: 12px 20px;
                    cursor: pointer; font-weight: 600; border-bottom: 3px solid transparent;
                    transition: all 0.3s;
                ">üîß Advanced</button>
            </div>
            
            <form id="settings-form" onsubmit="handleSettingsSave(event)" style="margin-top: 30px;">
                
                <!-- GENERAL TAB -->
                <div id="pref-panel-general" class="pref-panel" style="display: flex; flex-direction: column; gap: 24px;">
                    <h3 style="color: #4ecdc4; margin: 0 0 12px 0; font-size: 1.2em;">üé® Appearance</h3>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Theme</label>
                        <select id="settings-theme" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer; transition: all 0.3s ease;
                        ">
                            <option value="dark">üåô Dark Mode (Default)</option>
                            <option value="light">‚òÄÔ∏è Light Mode</option>
                            <option value="wooden">ü™µ Wooden Theme</option>
                            <option value="neon">üåà Neon Theme</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 12px; font-size: 0.95em;">Board Zoom</label>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <input type="range" id="settings-zoom" min="0.5" max="2" step="0.1" value="1" style="flex: 1; cursor: pointer;">
                            <span id="zoom-value" style="color: #ffd700; font-weight: bold; min-width: 50px;">100%</span>
                        </div>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">Adjust board scale for comfort</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üîä Audio & Notifications</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-audio" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Enable Audio</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Sound effects and music</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-move-sounds" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Move Sounds</span>
                        </label>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-capture-sounds" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Capture Sounds</span>
                        </label>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-notifications" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Desktop Notifications</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Get notified when it's your turn</p>
                    </div>
                </div>
                
                <!-- GAMEPLAY TAB -->
                <div id="pref-panel-gameplay" class="pref-panel" style="display: none; flex-direction: column; gap: 24px;">
                    <h3 style="color: #4ecdc4; margin: 0 0 12px 0; font-size: 1.2em;">üéØ Move Assistance</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-legal-moves" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Legal Moves</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Highlight valid moves when selecting piece</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-attack-moves" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Attack Moves</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Highlight attack moves with red indicators</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-threatened" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Threatened Pieces</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Highlight pieces under attack</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-last-move" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Highlight Last Move</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Show opponent's previous move</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-confirm-moves" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Confirm Dangerous Moves</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Ask before risky moves (sacrifice, blunder)</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">‚öôÔ∏è Input Controls</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-drag-drop" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Enable Drag & Drop</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Drag pieces to move them</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-click-move" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Enable Click-to-Move</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Click piece then destination hex</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-keyboard-navigation" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Keyboard Navigation</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Use arrow keys and Enter to move</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">‚ôüÔ∏è Game Rules</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-auto-queen" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Auto-Promote to Queen</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Automatically promote rhombus reaching back line</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-enforce-legal-moves" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Enforce Legal Moves Only</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Prevent illegal moves (disable for testing)</p>
                    </div>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Move Speed Limit</label>
                        <select id="settings-move-speed" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer;
                        ">
                            <option value="none">None (instant moves)</option>
                            <option value="250">Fast (0.25s delay)</option>
                            <option value="500" selected>Normal (0.5s delay)</option>
                            <option value="1000">Slow (1s delay)</option>
                        </select>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">Minimum time between moves (prevents accidents)</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üìä Board Display</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-coords" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Hex Coordinates</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Display coordinate labels (0-0, 1-2, etc.)</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-zones" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Zone Colors</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Color-code board zones (custom games)</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-piece-shadows" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Piece Shadows</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Add drop shadow to pieces for depth</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üìä Analysis & Learning</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-engine-analysis" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Enable Engine Analysis</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Show position evaluation bar (Coming Soon)</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-move-hints" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Move Hints</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Suggest good moves during games</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-blunder-warnings" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Warn About Blunders</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Alert when making a bad move</p>
                    </div>
                </div>
                
                <!-- LOBBY TAB -->
                <div id="pref-panel-lobby" class="pref-panel" style="display: none; flex-direction: column; gap: 24px;">
                    <h3 style="color: #4ecdc4; margin: 0 0 12px 0; font-size: 1.2em;">üéÆ Matchmaking</h3>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Quick Match Time Control</label>
                        <select id="settings-quickmatch-time" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer;
                        ">
                            <option value="1min">‚ö° Bullet (1 min)</option>
                            <option value="3min">üöÄ Blitz (3 min)</option>
                            <option value="5min" selected>‚è±Ô∏è Rapid (5 min)</option>
                            <option value="10min">üéØ Standard (10 min)</option>
                            <option value="30min">‚ôüÔ∏è Classical (30 min)</option>
                            <option value="unlimited">‚àû Unlimited</option>
                        </select>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">Default time for Quick Match</p>
                    </div>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Skill Range</label>
                        <select id="settings-skill-range" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer;
                        ">
                            <option value="strict">¬±50 rating (strict)</option>
                            <option value="moderate" selected>¬±150 rating (moderate)</option>
                            <option value="wide">¬±300 rating (wide)</option>
                            <option value="any">Any rating</option>
                        </select>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">Match with similar skill level</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-auto-accept" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Auto-Accept Matches</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Automatically accept when match found</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-rematch-prompt" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Prompt for Rematch</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Ask after game if you want a rematch</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üë• Social Features</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-player-avatars" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Player Avatars</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Display profile pictures in lobby</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-player-count" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Online Player Count</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Display number of active players</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-lobby-chat" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Enable Lobby Chat</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Show global chat in main lobby</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-friend-notifications" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Friend Login Notifications</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Get notified when friends come online</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üé® Lobby Appearance</h3>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Game List Sort</label>
                        <select id="settings-game-sort" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer;
                        ">
                            <option value="recent">üìÖ Most Recent</option>
                            <option value="rating">‚≠ê Highest Rating</option>
                            <option value="time">‚è±Ô∏è Time Control</option>
                            <option value="players">üë• Most Players</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-game-previews" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Game Previews</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Display board thumbnails in lobby</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-compact-lobby" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Compact Lobby View</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Show more games per screen</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üîî Game Invitations</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-accept-challenges" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Accept Challenges from Anyone</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Allow strangers to invite you</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-friends-only" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Friends Only Mode</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Only accept from friends list</p>
                    </div>
                </div>
                
                <!-- CUSTOM GAMES TAB -->
                <div id="pref-panel-custom-games" class="pref-panel" style="display: none; flex-direction: column; gap: 24px;">
                    <h3 style="color: #4ecdc4; margin: 0 0 12px 0; font-size: 1.2em;">üé® Creator Preferences</h3>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Default Board Size</label>
                        <select id="settings-default-board" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer;
                        ">
                            <option value="7x7">7√ó7 (Classic)</option>
                            <option value="9x11">9√ó11 (Extended)</option>
                            <option value="11x13">11√ó13 (Medium)</option>
                            <option value="13x15">13√ó15 (Large)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-auto-save" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Auto-Save Games</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Automatically save custom games while creating</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-grid" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Grid in Designer</span>
                        </label>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">ÔøΩ Publishing & Privacy</h3>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Default Visibility</label>
                        <select id="settings-game-visibility" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer;
                        ">
                            <option value="public">üåç Public (Anyone can play)</option>
                            <option value="unlisted">üîó Unlisted (Only with link)</option>
                            <option value="private">üîí Private (Only you)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-allow-remixes" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Allow Others to Remix</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Let others create variants of your games</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-creator-name" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Creator Name</span>
                        </label>
                    </div>
                </div>
                
                <!-- ACCOUNT TAB -->
                <div id="pref-panel-account" class="pref-panel" style="display: none; flex-direction: column; gap: 24px;">
                    <h3 style="color: #4ecdc4; margin: 0 0 12px 0; font-size: 1.2em;">üë§ Profile Settings</h3>
                    
                    <!-- Player Hub Button -->
                    <div style="
                        background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
                        border: 2px solid rgba(102, 126, 234, 0.4);
                        border-radius: 12px;
                        padding: 20px;
                        text-align: center;
                    ">
                        <h4 style="margin: 0 0 12px 0; color: #667eea; font-size: 1.1em;">üéÆ Player Hub</h4>
                        <p style="color: #aaa; font-size: 0.9em; margin: 0 0 16px 0;">
                            View your complete profile, stats, achievements, and game history
                        </p>
                        <button onclick="hideSettingsModal(); showAccountModal();" style="
                            background: linear-gradient(135deg, #667eea, #764ba2);
                            color: white;
                            border: none;
                            padding: 12px 32px;
                            border-radius: 8px;
                            font-size: 1em;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'">
                            üöÄ Open Player Hub
                        </button>
                    </div>
                    
                    <div style="border-top: 2px solid rgba(78, 205, 196, 0.2); padding-top: 20px;"></div>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Display Name</label>
                        <input type="text" id="settings-display-name" placeholder="Your Name" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; box-sizing: border-box;
                        ">
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">How others see you in multiplayer</p>
                    </div>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Email (Optional)</label>
                        <input type="email" id="settings-email" placeholder="your@email.com" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; box-sizing: border-box;
                        ">
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">For password recovery and notifications</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">ÔøΩ Privacy</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-stats" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show My Statistics</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Allow others to see your win/loss record</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-online" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Online Status</span>
                        </label>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-allow-challenges" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Allow Game Challenges</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Let others invite you to games</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üéÆ Guest Mode</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-guest-access" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Enable Guest Access</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Allow playing without account creation</p>
                    </div>
                </div>
                
                <!-- GAME CREATOR TAB -->
                <div id="pref-panel-game-creator" class="pref-panel" style="display: none; flex-direction: column; gap: 24px;">
                    <h3 style="color: #4ecdc4; margin: 0 0 12px 0; font-size: 1.2em;">üõ†Ô∏è Creator Interface</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-grid-creator" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Hex Grid</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Display grid lines between hexagons</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-snap-to-grid" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Snap to Grid</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Auto-align pieces to hex centers</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-zone-names" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Zone Names</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Label zones with their names</p>
                    </div>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Auto-Save Frequency</label>
                        <select id="settings-autosave-freq" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer;
                        ">
                            <option value="off">Off (manual only)</option>
                            <option value="30s">Every 30 seconds</option>
                            <option value="1min">Every minute</option>
                            <option value="3min" selected>Every 3 minutes</option>
                            <option value="5min">Every 5 minutes</option>
                        </select>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üé® Piece Tools</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-multi-select" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Enable Multi-Select</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Select multiple pieces with Ctrl+Click</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-copy-paste" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Enable Copy/Paste</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Duplicate pieces with Ctrl+C/V</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-undo-redo" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Unlimited Undo/Redo</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Track full edit history</p>
                    </div>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Piece Palette Layout</label>
                        <select id="settings-palette-layout" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer;
                        ">
                            <option value="sidebar" selected>Sidebar (right panel)</option>
                            <option value="bottom">Bottom toolbar</option>
                            <option value="floating">Floating palette</option>
                            <option value="popup">Click-to-open popup</option>
                        </select>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üß™ Testing & Validation</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-auto-validate" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Auto-Validate Rules</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Check for errors while creating</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-playtest-mode" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Quick Playtest Mode</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Test game without saving (Alt+P)</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-warn-unfinished" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Warn About Incomplete Games</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Alert if missing pieces, zones, or patterns</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üìö Templates & Presets</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-templates" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Template Library</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Browse starting templates on launch</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-save-as-template" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Save Custom Templates</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Create reusable starting boards</p>
                    </div>
                </div>
                
                <!-- ENGINE TAB -->
                <div id="pref-panel-engine" class="pref-panel" style="display: none; flex-direction: column; gap: 24px;">
                    <h3 style="color: #4ecdc4; margin: 0 0 12px 0; font-size: 1.2em;">‚ö° Performance Settings</h3>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Engine Strength</label>
                        <select id="settings-engine-strength" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer;
                        ">
                            <option value="1">Level 1 (Beginner)</option>
                            <option value="3">Level 3 (Novice)</option>
                            <option value="5" selected>Level 5 (Intermediate)</option>
                            <option value="7">Level 7 (Advanced)</option>
                            <option value="10">Level 10 (Expert)</option>
                            <option value="max">Maximum (Unlimited)</option>
                        </select>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">CPU strength for computer opponent</p>
                    </div>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 12px; font-size: 0.95em;">Search Depth</label>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <input type="range" id="settings-search-depth" min="3" max="20" step="1" value="10" style="flex: 1; cursor: pointer;">
                            <span id="depth-value" style="color: #ffd700; font-weight: bold; min-width: 70px;">10 moves</span>
                        </div>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">How many moves ahead to analyze</p>
                    </div>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Move Time Limit</label>
                        <select id="settings-move-time-limit" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer;
                        ">
                            <option value="100">0.1s (Lightning)</option>
                            <option value="500">0.5s (Fast)</option>
                            <option value="1000">1s (Quick)</option>
                            <option value="3000" selected>3s (Normal)</option>
                            <option value="5000">5s (Thoughtful)</option>
                            <option value="10000">10s (Deep)</option>
                            <option value="unlimited">Unlimited (Best Move)</option>
                        </select>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">Max time per move calculation</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üß† AI Behavior</h3>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Playing Style</label>
                        <select id="settings-ai-style" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer;
                        ">
                            <option value="balanced" selected>‚öñÔ∏è Balanced</option>
                            <option value="aggressive">‚öîÔ∏è Aggressive (attacks)</option>
                            <option value="defensive">üõ°Ô∏è Defensive (safe)</option>
                            <option value="positional">‚ôüÔ∏è Positional (strategic)</option>
                            <option value="tactical">üéØ Tactical (tricky)</option>
                            <option value="random">üé≤ Random (unpredictable)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-opening-book" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Use Opening Book</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Play known openings (first 10 moves)</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-endgame-tables" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Endgame Tablebases</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Perfect play in 5-piece endgames</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-contempt-factor" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Contempt (Avoid Draws)</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Engine prefers winning chances over draws</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üìä Analysis Display</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-eval-bar" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Evaluation Bar</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Display position advantage (¬±score)</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-show-best-move" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Highlight Best Move</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Show engine's top choice</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-multi-pv" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show Multiple Lines</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Display top 3 move candidates</p>
                    </div>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Analysis Updates</label>
                        <select id="settings-analysis-frequency" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer;
                        ">
                            <option value="realtime" selected>Real-time (live)</option>
                            <option value="1s">Every 1 second</option>
                            <option value="3s">Every 3 seconds</option>
                            <option value="5s">Every 5 seconds</option>
                            <option value="manual">Manual only (Ctrl+A)</option>
                        </select>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">How often to refresh analysis</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üîß Advanced Tuning</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-multi-threading" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Multi-Threading</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Use all CPU cores (4x faster on quad-core)</p>
                    </div>
                    
                    <div>
                        <label style="display: block; color: #4ecdc4; font-weight: 600; margin-bottom: 8px; font-size: 0.95em;">Hash Table Size</label>
                        <select id="settings-hash-size" style="
                            width: 100%; padding: 10px 12px; background: #1a1e26;
                            border: 2px solid #a55eea; border-radius: 8px; color: #fff;
                            font-size: 1em; cursor: pointer;
                        ">
                            <option value="16">16 MB (Low RAM)</option>
                            <option value="64">64 MB (Standard)</option>
                            <option value="128" selected>128 MB (Recommended)</option>
                            <option value="256">256 MB (High)</option>
                            <option value="512">512 MB (Maximum)</option>
                        </select>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">Memory for move caching</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-syzygy-probe" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Syzygy Tablebase Probing</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Query online endgame databases</p>
                    </div>
                </div>
                
                <!-- ADVANCED TAB -->
                <div id="pref-panel-advanced" class="pref-panel" style="display: none; flex-direction: column; gap: 24px;">
                    <h3 style="color: #4ecdc4; margin: 0 0 12px 0; font-size: 1.2em;">üîß Performance</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-hardware-accel" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Hardware Acceleration</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Use GPU for rendering (restart required)</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-animations" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Enable Animations</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Smooth transitions and effects</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üíæ Data Management</h3>
                    
                    <div>
                        <button type="button" onclick="exportUserData()" style="
                            width: 100%; padding: 12px; background: #4ecdc4; color: #23272e;
                            border: none; border-radius: 8px; font-weight: 700; cursor: pointer;
                            transition: all 0.3s;
                        " onmouseover="this.style.background='#5ee6d6'" onmouseout="this.style.background='#4ecdc4'">
                            üì¶ Export My Data
                        </button>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">Download all your games, stats, and settings</p>
                    </div>
                    
                    <div>
                        <button type="button" onclick="importUserData()" style="
                            width: 100%; padding: 12px; background: #f1c40f; color: #23272e;
                            border: none; border-radius: 8px; font-weight: 700; cursor: pointer;
                            transition: all 0.3s;
                        " onmouseover="this.style.background='#f5d657'" onmouseout="this.style.background='#f1c40f'">
                            üì• Import Data
                        </button>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">Restore from backup file</p>
                    </div>
                    
                    <div>
                        <button type="button" onclick="clearAllData()" style="
                            width: 100%; padding: 12px; background: #e74c3c; color: #fff;
                            border: none; border-radius: 8px; font-weight: 700; cursor: pointer;
                            transition: all 0.3s;
                        " onmouseover="this.style.background='#f55e4e'" onmouseout="this.style.background='#e74c3c'">
                            üóëÔ∏è Clear All Local Data
                        </button>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">‚ö†Ô∏è This will delete all saved games and settings</p>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üêõ Debugging</h3>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-debug-mode" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Enable Debug Mode</span>
                        </label>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 30px;">Show console logs and diagnostic info</p>
                    </div>
                    
                    <div>
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                            <input type="checkbox" id="settings-fps-counter" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: #fff; font-weight: 600; font-size: 0.95em;">Show FPS Counter</span>
                        </label>
                    </div>
                    
                    <h3 style="color: #4ecdc4; margin: 24px 0 12px 0; font-size: 1.2em;">üîß Developer Tools</h3>
                    
                    <div>
                        <button type="button" onclick="window.open('engine-analysis.html', '_blank')" style="
                            width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff;
                            border: none; border-radius: 8px; font-weight: 700; cursor: pointer;
                            transition: all 0.3s;
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'" 
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            üîç Open Engine Analysis Dashboard
                        </button>
                        <p style="color: #999; font-size: 0.9em; margin: 8px 0 0 0;">Monitor health, performance, connections & optimizations</p>
                    </div>
                </div>
                
                <div style="display: flex; gap: 12px; padding-top: 24px; border-top: 2px solid #333;">
                    <button type="submit" style="
                        flex: 1;
                        background: linear-gradient(135deg, #a55eea, #b075ff);
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 8px;
                        font-weight: 700;
                        font-size: 1em;
                        cursor: pointer;
                        box-shadow: 0 4px 15px rgba(165, 94, 234, 0.3);
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(165, 94, 234, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(165, 94, 234, 0.3)'">
                        ‚úì Save All Settings
                    </button>
                    <button type="button" onclick="resetToDefaults()" style="
                        flex: 0.8;
                        background: transparent;
                        color: #888;
                        border: 2px solid #888;
                        padding: 10px 24px;
                        border-radius: 8px;
                        font-weight: 600;
                        font-size: 1em;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.color='#aaa'; this.style.borderColor='#aaa'" onmouseout="this.style.color='#888'; this.style.borderColor='#888'">
                        üîÑ Reset
                    </button>
                    <button type="button" onclick="hideSettingsModal()" style="
                        flex: 0.7;
                        background: transparent;
                        color: #888;
                        border: 2px solid #888;
                        padding: 10px 24px;
                        border-radius: 8px;
                        font-weight: 600;
                        font-size: 1em;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.color='#aaa'; this.style.borderColor='#aaa'" onmouseout="this.style.color='#888'; this.style.borderColor='#888'">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Game Info Modal -->
    <div id="game-info-modal" style="
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(20, 24, 32, 0.98);
        z-index: 3001;
        overflow-y: auto;
        padding: 0; margin: 0;
        backdrop-filter: blur(4px);
    ">
        <div style="
            max-width: 700px;
            margin: 60px auto;
            background: #23272e;
            border-radius: 18px;
            box-shadow: 0 8px 40px #000a;
            padding: 40px 36px;
            color: #fff;
            position: relative;
        ">
            <button onclick="hideGameInfoModal()" style="
                position: absolute; top: 18px; right: 18px;
                background: #4ecdc4; color: #23272e;
                border: none; border-radius: 8px;
                font-size: 1.2em; font-weight: bold;
                padding: 6px 16px; cursor: pointer; z-index: 10;
                transition: all 0.3s ease;
            " onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">‚úñÔ∏è</button>
            
            <h2 style="color: #4ecdc4; margin-top: 0; text-align: center; font-size: 1.8em;">üìñ How to Play</h2>
            
            <div id="game-info-content" style="display: flex; flex-direction: column; gap: 24px;">
                <!-- Game Objective -->
                <div>
                    <h3 style="color: #ff6b6b; margin: 0 0 12px 0; font-size: 1.3em;">üéØ Objective</h3>
                    <p id="game-objective-text" style="color: #ddd; font-size: 1em; line-height: 1.6;">
                        Eliminate all opponent pieces or capture their base to win!
                    </p>
                </div>
                
                <!-- Zone Guide -->
                <div id="zone-guide-section">
                    <h3 style="color: #ffd700; margin: 0 0 12px 0; font-size: 1.3em;">üó∫Ô∏è Zone Guide</h3>
                    <div id="zone-guide-content" style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                        <!-- Classic Zones -->
                        <div style="background: rgba(78, 205, 196, 0.1); border-left: 4px solid #4ecdc4; padding: 12px; border-radius: 8px;">
                            <strong style="color: #4ecdc4;">üîµ Base Zone</strong>
                            <p style="color: #bbb; margin: 4px 0 0 0; font-size: 0.95em;">Your starting position and fortress. Protect at all costs!</p>
                        </div>
                        <div style="background: rgba(155, 89, 182, 0.1); border-left: 4px solid #9b59b6; padding: 12px; border-radius: 8px;">
                            <strong style="color: #9b59b6;">üü£ Inner Zone</strong>
                            <p style="color: #bbb; margin: 4px 0 0 0; font-size: 0.95em;">Close defense area with strategic importance.</p>
                        </div>
                        <div style="background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498db; padding: 12px; border-radius: 8px;">
                            <strong style="color: #3498db;">üî∑ Middle Zone</strong>
                            <p style="color: #bbb; margin: 4px 0 0 0; font-size: 0.95em;">Neutral territory for tactical positioning.</p>
                        </div>
                        <div style="background: rgba(46, 204, 113, 0.1); border-left: 4px solid #2ecc71; padding: 12px; border-radius: 8px;">
                            <strong style="color: #2ecc71;">üü¢ Outer Zone</strong>
                            <p style="color: #bbb; margin: 4px 0 0 0; font-size: 0.95em;">Opponent's defense perimeter.</p>
                        </div>
                        <div style="background: rgba(127, 140, 141, 0.1); border-left: 4px solid #7f8c8d; padding: 12px; border-radius: 8px;">
                            <strong style="color: #7f8c8d;">‚ö´ Dead Zone</strong>
                            <p style="color: #bbb; margin: 4px 0 0 0; font-size: 0.95em;">Impassable hexes or special areas.</p>
                        </div>
                    </div>
                    
                    <!-- Special Zones (Dynamic) -->
                    <div id="special-zones-info" style="display: none; margin-top: 16px;">
                        <h4 style="color: #ff6b6b; margin: 12px 0 8px 0; font-size: 1.1em;">‚ú® Special Mechanics</h4>
                        <div id="special-zones-list" style="display: grid; grid-template-columns: 1fr; gap: 8px;">
                            <!-- Dynamically populated based on game config -->
                        </div>
                    </div>
                </div>
                
                <!-- Game Mechanics -->
                <div id="mechanics-section">
                    <h3 style="color: #a55eea; margin: 0 0 12px 0; font-size: 1.3em;">üéÆ Active Mechanics</h3>
                    <ul id="mechanics-list" style="color: #ddd; font-size: 1em; line-height: 1.8; margin: 0; padding-left: 20px;">
                        <li>Move pieces strategically across hexagonal zones</li>
                        <li>Attack adjacent opponent pieces to capture them</li>
                        <li>Rotate triangles and hexagons to change attack directions</li>
                        <li>Build fortress defenses in your base zone</li>
                    </ul>
                </div>
                
                <!-- Quick Controls -->
                <div>
                    <h3 style="color: #fdcb6e; margin: 0 0 12px 0; font-size: 1.3em;">‚å®Ô∏è Quick Controls</h3>
                    <div style="background: rgba(253, 203, 110, 0.1); border-radius: 8px; padding: 16px;">
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 8px 16px; color: #ddd; font-size: 0.95em;">
                            <strong style="color: #fdcb6e;">Click Piece</strong>
                            <span>Select and see available moves</span>
                            
                            <strong style="color: #fdcb6e;">Drag & Drop</strong>
                            <span>Move pieces to valid hexes</span>
                            
                            <strong style="color: #fdcb6e;">‚Ü∫ / ‚Üª Buttons</strong>
                            <span>Rotate selected triangle/hexagon</span>
                            
                            <strong style="color: #fdcb6e;">KEEP Button</strong>
                            <span>End turn without rotating</span>
                            
                            <strong style="color: #fdcb6e;">RELEASE</strong>
                            <span>Deselect piece and choose another</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 24px; padding-top: 20px; border-top: 2px solid #333; text-align: center;">
                <button onclick="hideGameInfoModal()" style="
                    background: linear-gradient(135deg, #4ecdc4, #44b3aa);
                    color: white;
                    border: none;
                    padding: 12px 32px;
                    border-radius: 8px;
                    font-weight: 700;
                    font-size: 1em;
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(78, 205, 196, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(78, 205, 196, 0.3)'">
                    ‚úì Got It!
                </button>
            </div>
        </div>
    </div>

    <!-- Statistics Dashboard Modal -->
    <!-- TEST: This comment was added to verify live deployment on romgon.net -->
    <div id="stats-dashboard-modal" style="
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(10, 12, 15, 0.98);
        z-index: 3000;
        overflow-y: auto;
        padding: 0; margin: 0;
    ">
        <div style="
            max-width: 800px;
            margin: 40px auto;
            background: #0e1013;
            border-radius: 18px;
            box-shadow: 0 8px 40px #000a;
            padding: 36px 32px 32px 32px;
            color: #fff;
            position: relative;
        ">
            <button onclick="hideStatsDashboard()" style="
                position: absolute; top: 18px; right: 18px;
                background: #f1c40f; color: #23272e;
                border: none; border-radius: 8px;
                font-size: 1.2em; font-weight: bold;
                padding: 6px 16px; cursor: pointer; z-index: 10;">‚úñÔ∏è Close</button>
            <h2 style="color: #f1c40f; margin-top: 0;">üìä Romgon Statistics Dashboard</h2>
            <div id="stats-dashboard-content">
                <!-- Stats will be rendered here -->
            </div>
        </div>
    </div>
    <script>
    // ============================================
    // RATING MANAGER - MUST BE FIRST!
    // Centralized rating system - single source of truth
    // ============================================
    const INITIAL_RATING = 1600;
    
    const RatingManager = {
        // Get current rating from all possible sources
        getCurrentRating(username) {
            // Priority order:
            // 1. Simple localStorage 'rating' key (used by lobby and backend sync)
            const simpleRating = localStorage.getItem('rating');
            if (simpleRating) {
                const rating = parseInt(simpleRating);
                console.log('üìä Rating from localStorage["rating"]:', rating);
                return rating;
            }
            
            // 2. romgon-users object
            const allUsers = JSON.parse(localStorage.getItem('romgon-users') || '{}');
            if (allUsers[username]?.rating) {
                console.log('üìä Rating from romgon-users:', allUsers[username].rating);
                return allUsers[username].rating;
            }
            
            // 3. currentUser object
            const currentUser = window.currentUser || JSON.parse(localStorage.getItem('romgon-user') || '{}');
            if (currentUser.rating) {
                console.log('üìä Rating from currentUser:', currentUser.rating);
                return currentUser.rating;
            }
            
            // 4. Default
            console.log('üìä Rating defaulting to:', INITIAL_RATING);
            return INITIAL_RATING;
        },
        
        // Save rating to ALL storage locations
        saveRating(username, newRating) {
            console.log(`üíæ RatingManager: Saving rating ${newRating} for ${username}`);
            
            // 1. Simple localStorage 'rating' key (PRIMARY - used by lobby)
            localStorage.setItem('rating', newRating.toString());
            console.log('  ‚úì Saved to localStorage["rating"]');
            
            // 2. romgon-users object
            const allUsers = JSON.parse(localStorage.getItem('romgon-users') || '{}');
            if (allUsers[username]) {
                allUsers[username].rating = newRating;
                localStorage.setItem('romgon-users', JSON.stringify(allUsers));
                console.log('  ‚úì Saved to romgon-users');
            }
            
            // 3. currentUser object
            const currentUserStr = localStorage.getItem('romgon-user');
            if (currentUserStr) {
                const currentUser = JSON.parse(currentUserStr);
                currentUser.rating = newRating;
                localStorage.setItem('romgon-user', JSON.stringify(currentUser));
                window.currentUser = currentUser;
                console.log('  ‚úì Saved to currentUser');
            }
            
            console.log('‚úÖ Rating saved to all storage locations');
        },
        
        // Initialize rating for new user
        initializeRating(username) {
            const currentRating = this.getCurrentRating(username);
            if (currentRating === INITIAL_RATING) {
                this.saveRating(username, INITIAL_RATING);
                console.log(`‚úÖ Initialized rating for ${username}: ${INITIAL_RATING}`);
            }
            return currentRating;
        }
    };
    
    // ============================================
    // STATISTICS & DASHBOARD FUNCTIONS
    // ============================================
    
    // Show/hide Statistics Dashboard modal
    function showStatsDashboard() {
        document.getElementById('stats-dashboard-modal').style.display = 'block';
        renderStatsDashboard();
    }
    function hideStatsDashboard() {
        document.getElementById('stats-dashboard-modal').style.display = 'none';
    }
    // Render statistics dashboard content (placeholder data)
    function renderStatsDashboard() {
        const currentUser = JSON.parse(localStorage.getItem('romgon-user') || '{}');
        if (!currentUser.username) {
            const content = document.getElementById('stats-dashboard-content');
            if (content) content.innerHTML = '<p style="color: #aaa;">Please log in to view statistics</p>';
            return;
        }
        
        const stats = getUserStats(currentUser.username);
        if (!stats) {
            const content = document.getElementById('stats-dashboard-content');
            if (content) content.innerHTML = '<p style="color: #aaa;">No statistics available</p>';
            return;
        }
        
        const winRate = getWinRate(currentUser.username);
        const avgMoves = getAvgMovesPerGame(currentUser.username);
        const totalCaptures = getTotalCaptures(currentUser.username);
        
        const content = document.getElementById('stats-dashboard-content');
        content.innerHTML = `
            <div style='margin-bottom:24px;'>
                <h3 style='color:#4ecdc4;'>üèÜ Win/Loss Record</h3>
                <p style='font-size:1.1em;'>Wins: <b>${stats.gamesWon}</b> | Losses: <b>${stats.gamesLost}</b> | Draws: <b>${stats.gamesDrawn}</b></p>
                <p style='color:#aaa; margin-top:8px;'>Win Rate: <b>${winRate}%</b> (${stats.gamesPlayed} total games)</p>
            </div>
            <div style='margin-bottom:24px;'>
                <h3 style='color:#a55eea;'>‚ôüÔ∏è Piece Performance</h3>
                <table style='width:100%; border-collapse:collapse;'>
                    <thead><tr style='color:#aaa;'><th>Piece</th><th>Captures</th><th>Survived</th><th>Lost</th></tr></thead>
                    <tbody>
                        <tr><td>Square</td><td>${stats.pieceStats.square.captures}</td><td>${stats.pieceStats.square.survived}</td><td>${stats.pieceStats.square.lost}</td></tr>
                        <tr><td>Triangle</td><td>${stats.pieceStats.triangle.captures}</td><td>${stats.pieceStats.triangle.survived}</td><td>${stats.pieceStats.triangle.lost}</td></tr>
                        <tr><td>Rhombus</td><td>${stats.pieceStats.rhombus.captures}</td><td>${stats.pieceStats.rhombus.survived}</td><td>${stats.pieceStats.rhombus.lost}</td></tr>
                        <tr><td>Circle</td><td>${stats.pieceStats.circle.captures}</td><td>${stats.pieceStats.circle.survived}</td><td>${stats.pieceStats.circle.lost}</td></tr>
                        <tr><td>Hexagon</td><td>${stats.pieceStats.hexagon.captures}</td><td>${stats.pieceStats.hexagon.survived}</td><td>${stats.pieceStats.hexagon.lost}</td></tr>
                    </tbody>
                </table>
            </div>
            <div style='margin-bottom:24px;'>
                <h3 style='color:#00b894;'>üìö Opening Repertoire</h3>
                <p style='color:#aaa;'>Opening data will be tracked during gameplay</p>
            </div>
            <div style='margin-bottom:24px;'>
                <h3 style='color:#0984e3;'>ÔøΩ Move Quality</h3>
                <p style='color:#aaa;'>Average Moves per Game: <b>${avgMoves}</b></p>
                <p style='color:#aaa;'>Average Captures per Game: <b>${stats.gamesPlayed > 0 ? Math.round(totalCaptures / stats.gamesPlayed) : 0}</b></p>
            </div>
            <div style='margin-bottom:24px;'>
                <h3 style='color:#ff6b6b;'>üèÖ Personal Records</h3>
                <ul style='color:#fff; font-size:1.05em;'>
                    <li>Longest Win Streak: <b>${stats.longestWinStreak}</b></li>
                    <li>Fastest Win: <b>${stats.fastestWin ? stats.fastestWin + ' moves' : 'N/A'}</b></li>
                    <li>Total Pieces Captured: <b>${totalCaptures}</b></li>
                    <li>Member Since: <b>${new Date(stats.registeredDate).toLocaleDateString()}</b></li>
                </ul>
            </div>
        `;
    }
    </script>
    <!-- Opening Book Modal -->
    <div id="opening-book-modal" style="
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(20, 24, 32, 0.98);
        z-index: 3000;
        overflow-y: auto;
        padding: 0; margin: 0;
    ">
        <div style="
            max-width: 800px;
            margin: 40px auto;
            background: #23272e;
            border-radius: 18px;
            box-shadow: 0 8px 40px #000a;
            padding: 36px 32px 32px 32px;
            color: #fff;
            position: relative;
        ">
            <button onclick="hideOpeningBook()" style="
                position: absolute; top: 18px; right: 18px;
                background: #4ecdc4; color: #23272e;
                border: none; border-radius: 8px;
                font-size: 1.2em; font-weight: bold;
                padding: 6px 16px; cursor: pointer; z-index: 10;">‚úñÔ∏è Close</button>
            <h2 style="color: #4ecdc4; margin-top: 0;">üìñ Romgon Opening Book</h2>
            <div id="opening-book-content">
                <!-- Opening list will be rendered here -->
            </div>
        </div>
    </div>

    <!-- All Games History Modal -->
    <div id="all-games-modal" style="
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(20, 24, 32, 0.98);
        z-index: 999999;
        overflow-y: auto;
        padding: 0; margin: 0;
        visibility: visible;
        opacity: 1;
    ">
        <div style="
            max-width: 1200px;
            margin: 40px auto;
            background: #23272e;
            border-radius: 18px;
            box-shadow: 0 8px 40px #000a;
            padding: 36px 32px 32px 32px;
            color: #fff;
            position: relative;
        ">
            <button onclick="hideAllGamesHistory()" style="
                position: absolute; top: 18px; right: 18px;
                background: #3498db; color: #fff;
                border: none; border-radius: 8px;
                font-size: 1.2em; font-weight: bold;
                padding: 6px 16px; cursor: pointer; z-index: 10;">‚úñÔ∏è Close</button>
            
            <h2 style="color: #3498db; margin-top: 0; margin-bottom: 20px;">üìú Full Game History</h2>
            <p style="color: #999; margin-bottom: 20px;">All games played on Romgon.net</p>

            <!-- Filters -->
            <div style="
                display: flex;
                gap: 15px;
                margin-bottom: 25px;
                flex-wrap: wrap;
                align-items: center;
            ">
                <input 
                    type="text" 
                    id="games-search-input" 
                    placeholder="Search by player name..."
                    style="
                        flex: 1;
                        min-width: 200px;
                        padding: 10px 15px;
                        background: #2a2e36;
                        border: 1px solid #3a3e46;
                        border-radius: 8px;
                        color: #fff;
                        font-size: 0.95em;
                    ">
                <button onclick="searchAllGames()" style="
                    padding: 10px 20px;
                    background: #3498db;
                    color: #fff;
                    border: none;
                    border-radius: 8px;
                    cursor: pointer;
                    font-weight: 600;
                ">üîç Search</button>
                <button onclick="clearSearchAllGames()" style="
                    padding: 10px 20px;
                    background: #555;
                    color: #fff;
                    border: none;
                    border-radius: 8px;
                    cursor: pointer;
                    font-weight: 600;
                ">Clear</button>
            </div>

            <!-- Games List -->
            <div id="all-games-content" style="
                background: #2a2e36;
                border-radius: 12px;
                padding: 20px;
                max-height: 500px;
                overflow-y: auto;
            ">
                <div style="text-align: center; color: #999; padding: 40px;">
                    Loading games...
                </div>
            </div>

            <!-- Pagination -->
            <div id="all-games-pagination" style="
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 10px;
                margin-top: 20px;
            ">
                <!-- Pagination buttons will be added here -->
            </div>
        </div>
    </div>

    <!-- Play Local/Online Options Modal -->
    <div id="play-options-modal" style="
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(20, 24, 32, 0.98);
        z-index: 999999;
        justify-content: center;
        align-items: center;
    ">
        <div style="
            max-width: 600px;
            background: linear-gradient(135deg, #23272e 0%, #2d3139 100%);
            border-radius: 20px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            padding: 40px;
            color: #fff;
            position: relative;
        ">
            <button onclick="hidePlayOptionsModal()" style="
                position: absolute; top: 15px; right: 15px;
                background: transparent;
                color: #fff;
                border: 2px solid rgba(255,255,255,0.3);
                border-radius: 8px;
                font-size: 1.1em;
                padding: 5px 12px;
                cursor: pointer;
                transition: all 0.2s;
            " onmouseover="this.style.background='rgba(255,255,255,0.1)'" onmouseout="this.style.background='transparent'">‚úñÔ∏è</button>
            
            <h2 style="color: #4ecdc4; margin-top: 0; margin-bottom: 10px; font-size: 1.8em;">üéÆ Play Local/Online</h2>
            <p style="color: #999; margin-bottom: 30px;">Choose how you want to play</p>

            <!-- Options -->
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <!-- Local PvP -->
                <button onclick="openGameVariantsModal('pvp'); hidePlayOptionsModal();" style="
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: #fff;
                    border: none;
                    padding: 20px;
                    border-radius: 12px;
                    cursor: pointer;
                    font-weight: 700;
                    font-size: 1.1em;
                    text-align: left;
                    transition: all 0.3s;
                    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
                " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)'">
                    <div style="font-size: 1.3em; margin-bottom: 5px;">üè† Local PvP</div>
                    <div style="font-size: 0.85em; opacity: 0.9; font-weight: 400;">Play against a friend on the same device</div>
                </button>

                <!-- Create Private Room -->
                <button onclick="showMultiplayerSection('create'); hidePlayOptionsModal();" style="
                    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                    color: #fff;
                    border: none;
                    padding: 20px;
                    border-radius: 12px;
                    cursor: pointer;
                    font-weight: 700;
                    font-size: 1.1em;
                    text-align: left;
                    transition: all 0.3s;
                    box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
                " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 20px rgba(245, 87, 108, 0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(245, 87, 108, 0.4)'">
                    <div style="font-size: 1.3em; margin-bottom: 5px;">üîê Create Private Room</div>
                    <div style="font-size: 0.85em; opacity: 0.9; font-weight: 400;">Create a room and invite friends with a code</div>
                </button>

                <!-- Join Public Rooms -->
                <button onclick="showMultiplayerSection('public'); hidePlayOptionsModal();" style="
                    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                    color: #fff;
                    border: none;
                    padding: 20px;
                    border-radius: 12px;
                    cursor: pointer;
                    font-weight: 700;
                    font-size: 1.1em;
                    text-align: left;
                    transition: all 0.3s;
                    box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
                " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 20px rgba(79, 172, 254, 0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(79, 172, 254, 0.4)'">
                    <div style="font-size: 1.3em; margin-bottom: 5px;">üåê Public Rooms</div>
                    <div style="font-size: 0.85em; opacity: 0.9; font-weight: 400;">Browse and join public game rooms</div>
                </button>
            </div>
        </div>
    </div>

    <script>
    // Show/hide Opening Book modal
    function showOpeningBook() {
        document.getElementById('opening-book-modal').style.display = 'block';
        renderOpeningBook();
    }
    function hideOpeningBook() {
        document.getElementById('opening-book-modal').style.display = 'none';
    }

    // ============================================
    // ALL GAMES HISTORY MODAL FUNCTIONS
    // ============================================
    
    let currentGamesPage = 1;
    let currentGamesSearch = '';
    const gamesPerPage = 50;

    async function showAllGamesHistory() {
        console.log('üéÆ Opening All Games History modal...');
        const modal = document.getElementById('all-games-modal');
        if (!modal) {
            console.error('‚ùå Modal element not found!');
            return;
        }
        
        console.log('üìç Modal found, current display:', modal.style.display);
        modal.style.display = 'block';
        modal.style.visibility = 'visible';
        modal.style.opacity = '1';
        console.log('üìç Modal display set to:', modal.style.display);
        console.log('üìç Modal computed style:', window.getComputedStyle(modal).display);
        console.log('üìç Modal z-index:', window.getComputedStyle(modal).zIndex);
        console.log('üìç Modal visibility:', window.getComputedStyle(modal).visibility);
        console.log('üìç Modal opacity:', window.getComputedStyle(modal).opacity);
        console.log('üìç Modal position:', window.getComputedStyle(modal).position);
        console.log('üìç Modal top:', window.getComputedStyle(modal).top);
        console.log('üìç Modal left:', window.getComputedStyle(modal).left);
        console.log('üìç Modal width:', window.getComputedStyle(modal).width);
        console.log('üìç Modal height:', window.getComputedStyle(modal).height);
        console.log('üìç Modal bounding rect:', modal.getBoundingClientRect());
        
        currentGamesPage = 1;
        currentGamesSearch = '';
        const searchInput = document.getElementById('games-search-input');
        if (searchInput) searchInput.value = '';
        await loadAllGames();
    }

    function hideAllGamesHistory() {
        document.getElementById('all-games-modal').style.display = 'none';
    }

    // Play Options Modal Functions
    function showPlayOptionsModal() {
        const modal = document.getElementById('play-options-modal');
        if (modal) {
            modal.style.display = 'flex';
        }
    }

    function hidePlayOptionsModal() {
        const modal = document.getElementById('play-options-modal');
        if (modal) {
            modal.style.display = 'none';
        }
    }

    // Navigate to multiplayer section
    function showMultiplayerSection(section) {
        // Open multiplayer modal
        openMultiplayerModal();
        
        // Navigate to specific section after a brief delay to ensure modal is open
        setTimeout(() => {
            if (section === 'create') {
                showRoomConfig();
            } else if (section === 'public') {
                showPublicRooms();
            }
        }, 100);
    }

    async function loadAllGames(page = 1) {
        const contentDiv = document.getElementById('all-games-content');
        if (!contentDiv) {
            console.error('‚ùå Content div not found!');
            return;
        }
        
        contentDiv.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">Loading games...</div>';

        try {
            const offset = (page - 1) * gamesPerPage;
            const apiUrl = typeof BACKEND_API_URL !== 'undefined' ? BACKEND_API_URL : 'https://api.romgon.net';
            let url = `${apiUrl}/api/games/all-history?limit=${gamesPerPage}&offset=${offset}`;
            
            console.log('üì° Fetching games from:', url);
            
            if (currentGamesSearch) {
                url += `&player=${encodeURIComponent(currentGamesSearch)}`;
            }

            const response = await fetch(url);
            const data = await response.json();

            console.log('‚úÖ Response:', response.status, data);

            if (!response.ok || !data.success) {
                throw new Error(data.error || 'Failed to load games');
            }

            if (data.games.length === 0) {
                contentDiv.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">No games found</div>';
                return;
            }

            console.log(`üìä Loaded ${data.games.length} games`);
            renderAllGames(data.games);
            renderGamesPagination(data.pagination);
        } catch (error) {
            console.error('‚ùå Error loading all games:', error);
            contentDiv.innerHTML = '<div style="text-align: center; color: #ff6b6b; padding: 40px;">Failed to load games. Please try again.</div>';
        }
    }

    function renderAllGames(games) {
        const contentDiv = document.getElementById('all-games-content');
        
        let html = '<div style="display: flex; flex-direction: column; gap: 12px;">';
        
        games.forEach(game => {
            const date = new Date(game.date);
            const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            // Handle null winner color
            const winnerColor = game.winner.color ? game.winner.color.toUpperCase() : 'UNKNOWN';
            
            // Handle avatar rendering - check if it's a base64 image or emoji
            const renderAvatar = (avatar) => {
                if (avatar && avatar.startsWith('data:image')) {
                    return `<img src="${avatar}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover;">`;
                }
                return `<span style="font-size: 1.5em;">${avatar || 'üòÄ'}</span>`;
            };
            
            const whiteAvatar = renderAvatar(game.whitePlayer.avatar);
            const blackAvatar = renderAvatar(game.blackPlayer.avatar);
            
            html += `
                <div style="
                    background: #23272e;
                    border: 1px solid #3a3e46;
                    border-radius: 10px;
                    padding: 16px;
                    transition: all 0.3s;
                " onmouseover="this.style.borderColor='#3498db'" onmouseout="this.style.borderColor='#3a3e46'">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div style="flex: 1; min-width: 250px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                ${whiteAvatar}
                                <span style="color: #fff; font-weight: 600;">${game.whitePlayer.name}</span>
                                <span style="color: #999; font-size: 0.9em;">(${game.whitePlayer.rating})</span>
                            </div>
                            <div style="color: #999; font-size: 0.9em; margin-left: 40px;">vs</div>
                            <div style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                                ${blackAvatar}
                                <span style="color: #fff; font-weight: 600;">${game.blackPlayer.name}</span>
                                <span style="color: #999; font-size: 0.9em;">(${game.blackPlayer.rating})</span>
                            </div>
                        </div>
                        
                        <div style="text-align: center;">
                            <div style="color: #4ecdc4; font-weight: 600; font-size: 1.1em; margin-bottom: 5px;">
                                üèÜ ${game.winner.name || 'Unknown'}
                            </div>
                            <div style="color: #999; font-size: 0.85em;">
                                ${winnerColor} wins
                            </div>
                            <div style="color: #999; font-size: 0.85em; margin-top: 5px;">
                                ${(game.reason || 'unknown').replace(/_/g, ' ')}
                            </div>
                        </div>
                        
                        <div style="text-align: right; min-width: 120px;">
                            <div style="color: #999; font-size: 0.85em; margin-bottom: 5px;">
                                ${game.moves || 0} moves
                            </div>
                            <div style="color: #999; font-size: 0.85em;">
                                ${game.duration || 'Unknown'}
                            </div>
                            <div style="color: #666; font-size: 0.8em; margin-top: 5px;">
                                ${dateStr}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        
        html += '</div>';
        contentDiv.innerHTML = html;
    }

    function renderGamesPagination(pagination) {
        const paginationDiv = document.getElementById('all-games-pagination');
        
        let html = '';
        
        // Previous button
        if (pagination.currentPage > 1) {
            html += `<button onclick="loadAllGames(${pagination.currentPage - 1}); currentGamesPage = ${pagination.currentPage - 1};" style="
                padding: 8px 16px;
                background: #3498db;
                color: #fff;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                