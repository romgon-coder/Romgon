<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Romgon Game Creator - Design Your Own Hexagonal Strategy Game</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .header-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .header-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .header-btn:hover {
            background: white;
            color: #667eea;
        }

        .workflow {
            display: flex;
            background: #f5f5f5;
            border-bottom: 3px solid #ddd;
            overflow-x: auto;
        }

        .step {
            flex: 1;
            min-width: 200px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1em;
            transition: all 0.3s;
            border: none;
            background: none;
            position: relative;
        }

        .step:not(:last-child)::after {
            content: '‚Üí';
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5em;
            color: #999;
        }

        .step:hover { background: #e8e8e8; }

        .step.active {
            background: white;
            color: #667eea;
            border-bottom: 4px solid #667eea;
        }

        .step.completed {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }

        .content {
            display: none;
            padding: 40px;
            min-height: 600px;
        }

        .content.active { display: block; }

        .section {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
        }

        .instructions {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 5px solid #2196f3;
        }

        .instructions h3 {
            margin-bottom: 12px;
            color: #1565c0;
            font-size: 1.3em;
        }

        .instructions ul {
            margin-left: 25px;
            line-height: 1.8;
        }

        .canvas-area {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
        }

        .canvas-panel {
            flex: 1;
            min-width: 350px;
        }

        .shape-option {
            padding: 10px;
            border: 3px solid transparent;
            border-radius: 12px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .shape-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.05);
        }

        .shape-option.selected {
            border-color: #28a745;
            background: #d4edda;
        }

        canvas {
            border: 3px solid #ddd;
            border-radius: 12px;
            background: white;
            cursor: crosshair;
            display: block;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .control-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .control-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #555;
            font-size: 1.05em;
        }

        .control-group input,
        .control-group select,
        .control-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .control-group input:focus,
        .control-group select:focus,
        .control-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .control-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.9em;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 12px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .checkbox-wrapper input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
        }

        .checkbox-wrapper label {
            cursor: pointer;
            font-weight: 500;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 35px;
            font-size: 1.15em;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 8px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn:active { transform: translateY(-1px); }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            box-shadow: 0 4px 15px rgba(250, 112, 154, 0.3);
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 25px;
        }

        .piece-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .piece-card {
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
        }

        .piece-card:hover {
            border-color: #667eea;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
            transform: translateY(-5px);
        }

        .piece-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .piece-card h3 {
            margin-bottom: 12px;
            color: #667eea;
            font-size: 1.3em;
        }

        .piece-card .delete-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #f5576c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            cursor: pointer;
            font-size: 1.3em;
            transition: all 0.3s;
        }

        .piece-card .delete-btn:hover {
            background: #e74c3c;
            transform: rotate(90deg);
        }

        .piece-preview {
            width: 100%;
            height: 160px;
            margin: 15px 0;
        }

        .alert {
            padding: 18px 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            font-weight: 500;
            font-size: 1.05em;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }

        .tool-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tool-btn {
            padding: 12px 25px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .tool-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .tool-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .json-viewer {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 25px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #667eea;
        }

        .close-modal {
            float: right;
            font-size: 2em;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #333;
        }

        .tag-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            min-height: 45px;
        }

        .tag {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .tag .remove-tag {
            cursor: pointer;
            font-weight: bold;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .workflow { overflow-x: scroll; }
            .step { min-width: 150px; padding: 15px; font-size: 0.9em; }
            .canvas-panel { min-width: 100%; }
            .controls { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-buttons">
                <button class="header-btn" onclick="window.location.href='index.html'">üè† Home</button>
                <button class="header-btn" onclick="window.location.href='game-library.html'">üìö Library</button>
                <button class="header-btn" onclick="saveProgress()">üíæ Save</button>
            </div>
            <h1>üéÆ Romgon Game Creator</h1>
            <p>Design your own hexagonal strategy game with custom pieces, rules, and boards</p>
        </div>

        <div class="workflow">
            <button class="step active" onclick="goToStep(0)">
                <div>Step 1</div>
                <small>Design Pieces</small>
            </button>
            <button class="step" onclick="goToStep(1)">
                <div>Step 2</div>
                <small>Movement Rules</small>
            </button>
            <button class="step" onclick="goToStep(2)">
                <div>Step 3</div>
                <small>Board Design</small>
            </button>
            <button class="step" onclick="goToStep(3)">
                <div>Step 4</div>
                <small>Game Rules</small>
            </button>
            <button class="step" onclick="goToStep(4)">
                <div>Step 5</div>
                <small>Test & Publish</small>
            </button>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 20%;"></div>
        </div>

        <!-- STEP 1: Design Pieces -->
        <div class="content active" id="step-0">
            <div class="instructions">
                <h3>üìê Step 1: Design Your Game Pieces</h3>
                <ul>
                    <li>Choose a geometric shape for your piece</li>
                    <li>Give each piece a name and choose its color</li>
                    <li>Set piece properties: rotation, abilities, behaviors</li>
                    <li>Create multiple piece types for your game</li>
                    <li>No SVG corruption - uses built-in shape images!</li>
                </ul>
            </div>

            <div class="section">
                <h2>Geometric Shape Designer</h2>
                <div style="background: #d4edda; border: 2px solid #28a745; padding: 15px; margin-bottom: 20px; border-radius: 8px;">
                    <strong>‚úÖ New System!</strong> Using geometric shapes instead of pixel art - no more SVG corruption issues!
                </div>
                
                <div class="canvas-area">
                    <div class="canvas-panel">
                        <h3>Choose Shape</h3>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; max-width: 400px;">
                            <div class="shape-option" onclick="selectShape('circle')" data-shape="circle">
                                <img src="ASSETS/circle black front.png" style="width: 100%; border-radius: 8px; cursor: pointer;">
                                <div style="text-align: center; margin-top: 5px; font-weight: 600;">Circle</div>
                            </div>
                            <div class="shape-option" onclick="selectShape('square')" data-shape="square">
                                <img src="ASSETS/square black front.png" style="width: 100%; border-radius: 8px; cursor: pointer;">
                                <div style="text-align: center; margin-top: 5px; font-weight: 600;">Square</div>
                            </div>
                            <div class="shape-option" onclick="selectShape('triangle')" data-shape="triangle">
                                <img src="ASSETS/Triangle black front.png" style="width: 100%; border-radius: 8px; cursor: pointer;">
                                <div style="text-align: center; margin-top: 5px; font-weight: 600;">Triangle</div>
                            </div>
                            <div class="shape-option" onclick="selectShape('hexagon')" data-shape="hexagon">
                                <img src="ASSETS/hexagon black front.png" style="width: 100%; border-radius: 8px; cursor: pointer;">
                                <div style="text-align: center; margin-top: 5px; font-weight: 600;">Hexagon</div>
                            </div>
                            <div class="shape-option" onclick="selectShape('rhombus')" data-shape="rhombus">
                                <img src="ASSETS/Rhombus black front.png" style="width: 100%; border-radius: 8px; cursor: pointer;">
                                <div style="text-align: center; margin-top: 5px; font-weight: 600;">Rhombus</div>
                            </div>
                        </div>
                        
                        <div id="shapePreview" style="margin-top: 20px; padding: 20px; background: white; border: 2px solid #333; border-radius: 8px; min-height: 150px; display: flex; align-items: center; justify-content: center;">
                            <div style="color: #999; font-style: italic;">Select a shape above</div>
                        </div>
                    </div>
                    <div class="canvas-panel">
                        <div class="controls">
                            <div class="control-group">
                                <label>Piece Name *</label>
                                <input type="text" id="pieceName" placeholder="e.g., Warrior, Defender, Scout">
                            </div>
                            <div class="control-group">
                                <label>Base Color</label>
                                <select id="pieceColor">
                                    <option value="black">Black</option>
                                    <option value="white">White</option>
                                    <option value="blue">Blue</option>
                                    <option value="red">Red</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>Description</label>
                                <textarea id="pieceDesc" rows="3" placeholder="Describe this piece's role..."></textarea>
                            </div>
                        </div>

                        <h3 style="margin: 20px 0 10px;">Piece Abilities</h3>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="canRotate" checked>
                            <label for="canRotate">Can Rotate (orientation-dependent movement)</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="canFlip">
                            <label for="canFlip">Can Flip (becomes omnidirectional when flipped)</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="canMove" checked>
                            <label for="canMove">Can Move</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="canAttack" checked>
                            <label for="canAttack">Can Attack</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="canDefend">
                            <label for="canDefend">Can Defend (protects adjacent pieces)</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="canEscape">
                            <label for="canEscape">Can Escape (from base hex)</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="canCapture" checked>
                            <label for="canCapture">Can Capture enemy pieces</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="canPush">
                            <label for="canPush">Can Push (pushes opponent to random adjacent hex instead of capturing)</label>
                        </div>

                        <button class="btn btn-success" onclick="savePieceShape()" style="margin-top: 20px; width: 100%;">
                            ‚úì Add to Collection
                        </button>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Your Piece Collection</h2>
                <div id="pieceGallery" class="piece-gallery">
                    <div class="alert alert-info">No pieces created yet. Design your first piece above!</div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="goToStep(1)">Next: Define Movement Rules ‚Üí</button>
            </div>
        </div>

        <!-- STEP 2: Movement Rules -->
        <div class="content" id="step-1">
            <div class="instructions">
                <h3>‚ö° Step 2: Define Movement Patterns</h3>
                <ul>
                    <li>Select a piece from your collection</li>
                    <li>Mark hexes where it can MOVE (green)</li>
                    <li>Mark hexes where it can ATTACK (red) - can be different from movement</li>
                    <li>Set movement range, jump ability, and capture rules</li>
                    <li>Configure special abilities and restrictions</li>
                </ul>
            </div>

            <div class="section">
                <h2>Movement Pattern Designer</h2>
                <div class="control-group">
                    <label>Select Shape to Configure:</label>
                    <select id="movePieceSelector" onchange="loadPieceForMovement()">
                        <option value="">-- Select a shape --</option>
                    </select>
                </div>

                <div class="tool-bar">
                    <button class="tool-btn active" onclick="setMoveTool('move')" data-tool="move">
                        ‚úì Movement (Green)
                    </button>
                    <button class="tool-btn" onclick="setMoveTool('attack')" data-tool="attack">
                        ‚öî Attack (Red)
                    </button>
                    <button class="tool-btn" onclick="setMoveTool('special')" data-tool="special">
                        ‚òÖ Special (Yellow)
                    </button>
                    <button class="btn btn-warning" onclick="clearAllMovement()" style="margin-left: auto;">
                        Clear All Patterns
                    </button>
                </div>

                <div class="canvas-area">
                    <div class="canvas-panel">
                        <h3>Click Hexes to Mark Valid Positions</h3>
                        <canvas id="moveCanvas" width="600" height="600" style="transform: rotate(90deg);"></canvas>
                        <div style="margin-top: 15px; font-size: 0.9em; color: #666;">
                            <strong>Tip:</strong> The piece is shown in the center. Click hexes around it to define movement/attack patterns.
                            Click again to remove a hex from the pattern.
                        </div>
                    </div>
                    <div class="canvas-panel">
                        <h3>Movement Configuration</h3>
                        <div class="controls">
                            <div class="control-group">
                                <label>Movement Type</label>
                                <select id="moveType">
                                    <option value="adjacent">Adjacent (1-6 directions)</option>
                                    <option value="directional">Directional (rotation-dependent)</option>
                                    <option value="ranged">Ranged (distance-based)</option>
                                    <option value="custom">Custom Pattern</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>Movement Range</label>
                                <input type="number" id="moveRange" min="1" max="20" value="1">
                                <small>Maximum hexes piece can move in one turn</small>
                            </div>
                        </div>

                        <h3 style="margin: 20px 0 10px;">Movement Rules</h3>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="canJump">
                            <label for="canJump">Can jump over other pieces</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="pathBlocked">
                            <label for="pathBlocked">Path is blocked by pieces</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="mustCapture">
                            <label for="mustCapture">Must capture if possible (forced capture)</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="mustAttack">
                            <label for="mustAttack">Must attack if in range</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="moveAndAttack">
                            <label for="moveAndAttack">Can move and attack in same turn</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="moveAndRotate">
                            <label for="moveAndRotate">Can move and rotate in same turn</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="canUseZones">
                            <label for="canUseZones">Movement affected by board zones</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="noFriendlyAttack" checked>
                            <label for="noFriendlyAttack">Cannot attack friendly pieces</label>
                        </div>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="noSameShapeAttack">
                            <label for="noSameShapeAttack">Cannot attack same shape type</label>
                        </div>

                        <div class="control-group" style="margin-top: 20px;">
                            <label>Special Ability (Optional)</label>
                            <textarea id="specialAbility" rows="3" placeholder="Describe any special movement or capture abilities..."></textarea>
                        </div>

                        <button class="btn btn-success" onclick="saveMovementPattern()" style="margin-top: 20px; width: 100%;">
                            ‚úì Save Movement Pattern
                        </button>
                    </div>
                </div>
                
                <!-- NEW: Hardcoded Pattern Display -->
                <div class="section" style="margin-top: 30px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 12px; padding: 20px;">
                    <h3 style="color: #2e7d32; margin-bottom: 15px;">üìä Hardcoded Pattern Preview</h3>
                    <p style="font-size: 0.9em; color: #555; margin-bottom: 15px;">
                        These relative coordinate arrays will be saved for accurate move highlighting (like original Romgon):
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="background: rgba(46, 204, 113, 0.1); padding: 15px; border-radius: 8px; border: 2px solid #2ecc71;">
                            <h4 style="color: #27ae60; margin-bottom: 10px;">üü¢ Movement Pattern</h4>
                            <pre id="hardcodedMoveDisplay" style="background: white; padding: 10px; border-radius: 4px; font-size: 0.85em; max-height: 200px; overflow-y: auto; margin: 0;">No movement pattern set</pre>
                        </div>
                        
                        <div style="background: rgba(231, 76, 60, 0.1); padding: 15px; border-radius: 8px; border: 2px solid #e74c3c;">
                            <h4 style="color: #c0392b; margin-bottom: 10px;">üî¥ Attack Pattern</h4>
                            <pre id="hardcodedAttackDisplay" style="background: white; padding: 10px; border-radius: 4px; font-size: 0.85em; max-height: 200px; overflow-y: auto; margin: 0;">No attack pattern set</pre>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 12px; background: rgba(52, 152, 219, 0.1); border-radius: 6px; border-left: 4px solid #3498db;">
                        <strong style="color: #2980b9;">üí° How it works:</strong>
                        <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #555;">
                            When a piece is selected during gameplay, these offset values are added to its current position to calculate valid moves/attacks. 
                            Example: If piece is at (3,4) and offset is {rowOffset: 1, colOffset: 0}, valid move is at (4,4).
                        </p>
                    </div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="goToStep(0)">‚Üê Back</button>
                <button class="btn btn-success" onclick="goToStep(2)">Next: Design Board ‚Üí</button>
            </div>
        </div>

        <!-- STEP 3: Board Design -->
        <div class="content" id="step-2">
            <div class="instructions">
                <h3>üé≤ Step 3: Design Your Game Board</h3>
                <ul>
                    <li>Set board dimensions and overall shape</li>
                    <li>Define hex zones (inner, middle, outer, dead zones)</li>
                    <li>Mark special hexes (base, escape, fortress positions)</li>
                    <li>Set starting positions for each player's pieces</li>
                    <li>Configure zone transitions and movement restrictions</li>
                </ul>
            </div>

            <div class="section">
                <h2>Board Configuration</h2>
                
                <div class="alert alert-info" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <strong>üéØ Quick Presets:</strong> Design classic Romgon boards or create massive variants!
                </div>
                
                <div class="controls" style="margin-bottom: 20px;">
                    <div class="control-group">
                        <label>Board Preset</label>
                        <select id="boardPreset" onchange="applyBoardPreset()">
                            <option value="">-- Custom Size --</option>
                            <option value="7x7">Classic Romgon (7√ó7)</option>
                            <option value="9x11">Extended Classic (9√ó11)</option>
                            <option value="11x13">Medium (11√ó13)</option>
                            <option value="13x15">Large (13√ó15)</option>
                            <option value="15x17">Extra Large (15√ó17)</option>
                            <option value="17x19">Huge (17√ó19)</option>
                            <option value="20x20">Massive Square (20√ó20)</option>
                            <option value="25x25">Epic (25√ó25)</option>
                        </select>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label>Board Width (columns)</label>
                        <input type="number" id="boardWidth" min="5" max="30" value="7" onchange="redrawBoard()">
                        <small>Hex columns (5-30)</small>
                    </div>
                    <div class="control-group">
                        <label>Board Height (rows)</label>
                        <input type="number" id="boardHeight" min="5" max="30" value="7" onchange="redrawBoard()">
                        <small>Hex rows (5-30)</small>
                    </div>
                    <div class="control-group">
                        <label>Board Shape</label>
                        <select id="boardShape" onchange="generateBoardShape()">
                            <option value="custom">Custom (Free-form)</option>
                            <option value="rectangle">Rectangle</option>
                        </select>
                        <small>Auto-shapes hexes by deleting edges</small>
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <button class="btn btn-primary" onclick="generateBoardShape()">üéØ Apply Board Shape</button>
                    <button class="btn btn-secondary" onclick="gameData.board.deletedHexes = []; redrawBoard();">‚Ü©Ô∏è Restore All Hexes</button>
                    <button class="btn btn-warning" onclick="clearBoardPlacements()">üóëÔ∏è Clear Board</button>
                </div>

                <h3 style="margin: 30px 0 15px;">Hex Zone Configuration</h3>
                <div class="controls">
                    <div class="control-group">
                        <label>Base Zone Color</label>
                        <input type="color" id="baseZoneColor" value="#8b4513">
                        <small>Starting positions only</small>
                    </div>
                    <div class="control-group">
                        <label>Inner Zone Color</label>
                        <input type="color" id="innerZoneColor" value="#6d3a13">
                        <small>Close to base</small>
                    </div>
                    <div class="control-group">
                        <label>Middle Zone Color</label>
                        <input type="color" id="middleZoneColor" value="#f57d2d">
                        <small>Main battlefield area</small>
                    </div>
                    <div class="control-group">
                        <label>Outer Zone Color</label>
                        <input type="color" id="outerZoneColor" value="#fcc49c">
                        <small>Edge hexes</small>
                    </div>
                    <div class="control-group">
                        <label>Dead Zone Color</label>
                        <input type="color" id="deadZoneColor" value="#333333">
                        <small>Unusable hexes</small>
                    </div>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="enableZoneTransitions" checked>
                    <label for="enableZoneTransitions">Enable zone-based movement restrictions</label>
                </div>
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="enableEscapeBase" checked>
                    <label for="enableEscapeBase">Pieces can escape from base hexes</label>
                </div>

                <h3 style="margin: 30px 0 15px;">Board Editor</h3>
                <div class="tool-bar">
                    <button class="tool-btn active" onclick="setBoardTool('view')" data-tool="view">
                        üëÅ View Only
                    </button>
                    <button class="tool-btn" onclick="setBoardTool('zone')" data-tool="zone">
                        üé® Paint Zones
                    </button>
                    <button class="tool-btn" onclick="setBoardTool('add')" data-tool="add">
                        ‚ûï Add Hex
                    </button>
                    <button class="tool-btn" onclick="setBoardTool('delete')" data-tool="delete">
                        üóë Delete Hex
                    </button>
                    <button class="tool-btn" onclick="setBoardTool('place')" data-tool="place">
                        üìç Place Shape
                    </button>
                </div>

                <div class="controls" id="zoneControls" style="display: none; margin: 20px 0;">
                    <div class="control-group">
                        <label>üé® Classic Zone to Paint</label>
                        <select id="zoneSelector">
                            <option value="base">üè∞ Base Zone (Starting Positions)</option>
                            <option value="inner">üõ°Ô∏è Inner Zone</option>
                            <option value="middle">‚öîÔ∏è Middle Zone (Battlefield)</option>
                            <option value="outer">üåê Outer Zone (Edge)</option>
                            <option value="dead">‚ò†Ô∏è Dead Zone</option>
                        </select>
                        <small>Standard Romgon zones for traditional gameplay</small>
                    </div>
                    
                    <div class="control-group" style="margin-top: 20px;">
                        <label>‚ú® Special Mechanic Zone to Paint</label>
                        <select id="specialZoneSelector">
                            <option value="">-- No Special Mechanic --</option>
                            <option value="teleport">üåÄ Teleport Zone - Transports pieces to linked location</option>
                            <option value="trap">üîí Trap Zone - Immobilizes pieces</option>
                            <option value="goal">üéØ Goal/Exit Zone - Win by reaching here</option>
                            <option value="collectable">‚≠ê Collectible Hex - Item to collect</option>
                            <option value="oneway_up">‚¨ÜÔ∏è One-Way Up - Only move upward</option>
                            <option value="oneway_down">‚¨áÔ∏è One-Way Down - Only move downward</option>
                            <option value="oneway_left">‚¨ÖÔ∏è One-Way Left - Only move left</option>
                            <option value="oneway_right">‚û°Ô∏è One-Way Right - Only move right</option>
                            <option value="slide">üßä Slide/Ice - Slide until obstacle</option>
                            <option value="boost">‚ö° Boost Zone - Double movement range</option>
                            <option value="slow">üêå Slow Zone - Reduced movement (mud/swamp)</option>
                            <option value="damage">üí• Damage Zone - Hurts pieces entering</option>
                            <option value="heal">üíö Heal Zone - Restores piece health</option>
                            <option value="spawn">üîÑ Spawn Point - Pieces respawn here</option>
                            <option value="checkpoint">üö© Checkpoint - Save progress point</option>
                        </select>
                        <small>Special zones for puzzle, race, and casual games</small>
                    </div>
                </div>

                <div style="text-align: right; margin: 30px 0; position: relative; height: 700px;">
                    <canvas id="boardCanvas" width="700" height="600" style="transform: rotate(90deg); position: absolute; right: 0; top: 50%; margin-top: -300px;"></canvas>
                </div>

                <h3 style="margin: 30px 0 15px;">Starting Positions</h3>
                <div class="alert alert-warning">
                    Use the "Place Shape" tool above to set starting positions on the board.
                    Select shape type and player below, then click on board hexes.
                </div>
                <div class="controls">
                    <div class="control-group">
                        <label>Shape to Place</label>
                        <select id="placePieceSelector">
                            <option value="">-- Select shape --</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Player</label>
                        <select id="placePlayer">
                            <option value="black">Black (Player 1)</option>
                            <option value="white">White (Player 2)</option>
                            <option value="blue">Blue (Player 3)</option>
                            <option value="red">Red (Player 4)</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="clearBoardPlacements()">Clear All Placements</button>
            </div>

            <div class="section">
                <h2>üéÆ Special Board Mechanics</h2>
                <p style="color: #666; margin-bottom: 15px;">Configure special zone behaviors and hex-based mechanics for your game</p>
                
                <h3 style="margin: 20px 0 15px;">Zone-Based Mechanics</h3>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="boardMechanicTeleport">
                    <label for="boardMechanicTeleport">üåÄ Teleport Zones - Mark specific zones that teleport pieces to other locations</label>
                </div>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="boardMechanicTrap">
                    <label for="boardMechanicTrap">üîí Trap Zones - Hexes that immobilize pieces when entered</label>
                </div>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="boardMechanicGoal">
                    <label for="boardMechanicGoal">üéØ Goal/Exit Zones - Mark zones as winning exit points</label>
                </div>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="boardMechanicCollectable">
                    <label for="boardMechanicCollectable">‚≠ê Collectible Hexes - Mark hexes with items to collect</label>
                </div>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="boardMechanicOneWay">
                    <label for="boardMechanicOneWay">‚û°Ô∏è Directional Hexes - Hexes that only allow movement in certain directions</label>
                </div>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="boardMechanicSlide">
                    <label for="boardMechanicSlide">üßä Slide/Ice Zones - Pieces slide until hitting obstacle (ice physics)</label>
                </div>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="boardMechanicBoost">
                    <label for="boardMechanicBoost">‚ö° Boost Zones - Double movement range when on these hexes</label>
                </div>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="boardMechanicSlow">
                    <label for="boardMechanicSlow">üêå Slow Zones - Reduced movement range (mud, swamp)</label>
                </div>
                
                <h3 style="margin: 30px 0 15px;">Board-Wide Rules</h3>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="boardMechanicWrap">
                    <label for="boardMechanicWrap">üîÑ Wraparound Board - Edges connect (like Pac-Man, torus topology)</label>
                </div>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="boardMechanicFog">
                    <label for="boardMechanicFog">üå´Ô∏è Fog of War - Players only see nearby hexes</label>
                </div>
                
                <div class="control-group" id="fogRangeGroup" style="margin-left: 30px; display: none;">
                    <label>Visibility Range (hexes)</label>
                    <input type="number" id="fogRange" min="1" max="10" value="3">
                    <small>How many hexes away players can see (1-10)</small>
                </div>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="boardMechanicDynamic">
                    <label for="boardMechanicDynamic">üîÄ Dynamic Board - Board changes during gameplay (hexes appear/disappear)</label>
                </div>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="boardMechanicGravity">
                    <label for="boardMechanicGravity">‚¨áÔ∏è Gravity Direction - Pieces "fall" toward specific direction</label>
                </div>
                
                <div class="control-group" id="gravityDirectionGroup" style="margin-left: 30px; display: none;">
                    <label>Gravity Direction</label>
                    <select id="gravityDirection">
                        <option value="down">Down (toward bottom rows)</option>
                        <option value="up">Up (toward top rows)</option>
                        <option value="left">Left</option>
                        <option value="right">Right</option>
                    </select>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="goToStep(1)">‚Üê Back</button>
                <button class="btn btn-success" onclick="goToStep(3)">Next: Game Rules ‚Üí</button>
            </div>
        </div>

        <!-- STEP 4: Game Rules -->
        <div class="content" id="step-3">
            <div class="instructions">
                <h3>‚öôÔ∏è Step 4: Configure Game Rules</h3>
                <ul>
                    <li>Set win conditions and game objectives</li>
                    <li>Configure turn limits and piece restrictions</li>
                    <li>Enable/disable game features (undo, chat, etc.)</li>
                    <li>Define special rules and mechanics</li>
                </ul>
            </div>

            <div class="section">
                <h2>Game Metadata</h2>
                <div class="controls">
                    <div class="control-group">
                        <label>Game Name *</label>
                        <input type="text" id="gameName" placeholder="My Hex Strategy Game">
                    </div>
                    <div class="control-group">
                        <label>Game Description</label>
                        <textarea id="gameDesc" rows="4" placeholder="Describe your game's objective and unique features..."></textarea>
                    </div>
                    <div class="control-group">
                        <label>Game Tags (comma-separated)</label>
                        <input type="text" id="gameTags" placeholder="strategy, fast-paced, fortress, elimination">
                        <small>Help players find your game</small>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Win Conditions</h2>
                <div class="controls">
                    <div class="control-group">
                        <label>Primary Win Condition *</label>
                        <select id="winCondition">
                            <option value="eliminate_all">Eliminate all enemy pieces</option>
                            <option value="capture_base">Capture enemy base</option>
                            <option value="reach_zone">Reach opponent's zone</option>
                            <option value="fortress">Break enemy fortress (3+ bases)</option>
                            <option value="piece_count">Capture specific number of pieces</option>
                            <option value="zone_control">Control majority of zones</option>
                            <option value="custom">Custom condition</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Turn Limit (0 = unlimited)</label>
                        <input type="number" id="maxTurns" min="0" value="0">
                        <small>Game ends after this many turns</small>
                    </div>
                    <div class="control-group">
                        <label>Turn Time Limit (seconds, 0 = unlimited)</label>
                        <input type="number" id="turnTimeLimit" min="0" value="60">
                    </div>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="enableDraw">
                    <label for="enableDraw">Allow draw/tie games</label>
                </div>
            </div>

            <div class="section">
                <h2>Piece Restrictions</h2>
                <div class="controls">
                    <div class="control-group">
                        <label>Maximum Shapes per Player</label>
                        <input type="number" id="maxShapes" min="1" max="50" value="10">
                    </div>
                    <div class="control-group">
                        <label>Maximum Pieces per Shape Type</label>
                        <input type="number" id="maxPerType" min="1" max="10" value="3">
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Game Features</h2>
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="enableUndo" checked>
                    <label for="enableUndo">Enable Undo/Redo</label>
                </div>
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="showHistory" checked>
                    <label for="showHistory">Show Move History</label>
                </div>
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="showPreview" checked>
                    <label for="showPreview">Show Move Preview (attack/move highlighting)</label>
                </div>
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="enableChat" checked>
                    <label for="enableChat">Enable In-Game Chat</label>
                </div>
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="allowGuests">
                    <label for="allowGuests">Allow Guest Players (no login required)</label>
                </div>
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="enableDragDrop" checked>
                    <label for="enableDragDrop">Enable Drag & Drop piece movement</label>
                </div>
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="enableClickMove" checked>
                    <label for="enableClickMove">Enable Click-to-Move (tap friendly)</label>
                </div>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="showZoneLegend" checked>
                    <label for="showZoneLegend">üìã Show Zone Legend - Display in-game panel explaining zone types and mechanics</label>
                </div>
            </div>

            <div class="section">
                <h2>üó∫Ô∏è Zone Legend Preview</h2>
                <p style="color: #666; margin-bottom: 15px;">This panel will appear in-game to help players understand your board zones</p>
                
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; color: white;">
                    <h3 style="margin: 0 0 15px 0; font-size: 1.3em;">üéØ Board Zones Guide</h3>
                    
                    <div id="zoneLegendPreview" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px;">
                        <!-- Classic Zones -->
                        <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <div style="width: 30px; height: 30px; background: #8b4513; border-radius: 6px; border: 2px solid white;"></div>
                                <strong style="font-size: 1.1em;">üè∞ Base Zone</strong>
                            </div>
                            <p style="margin: 0; font-size: 0.9em; opacity: 0.95;">Starting positions for pieces. Your home territory.</p>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <div style="width: 30px; height: 30px; background: #6d3a13; border-radius: 6px; border: 2px solid white;"></div>
                                <strong style="font-size: 1.1em;">üõ°Ô∏è Inner Zone</strong>
                            </div>
                            <p style="margin: 0; font-size: 0.9em; opacity: 0.95;">Close to base. Defensive positions.</p>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <div style="width: 30px; height: 30px; background: #f57d2d; border-radius: 6px; border: 2px solid white;"></div>
                                <strong style="font-size: 1.1em;">‚öîÔ∏è Middle Zone</strong>
                            </div>
                            <p style="margin: 0; font-size: 0.9em; opacity: 0.95;">Main battlefield area. Where most action happens.</p>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <div style="width: 30px; height: 30px; background: #fcc49c; border-radius: 6px; border: 2px solid white;"></div>
                                <strong style="font-size: 1.1em;">üåê Outer Zone</strong>
                            </div>
                            <p style="margin: 0; font-size: 0.9em; opacity: 0.95;">Edge hexes. Border of the playable area.</p>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <div style="width: 30px; height: 30px; background: #333333; border-radius: 6px; border: 2px solid white;"></div>
                                <strong style="font-size: 1.1em;">‚ò†Ô∏è Dead Zone</strong>
                            </div>
                            <p style="margin: 0; font-size: 0.9em; opacity: 0.95;">Unusable hexes. Cannot move here.</p>
                        </div>
                        
                        <!-- Special Zones - Only show if used -->
                        <div id="specialZonesLegend" style="display: none; grid-column: 1 / -1;">
                            <hr style="border: 1px solid rgba(255,255,255,0.3); margin: 15px 0;">
                            <h4 style="margin: 0 0 12px 0; font-size: 1.2em;">‚ú® Special Zone Mechanics</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 12px;">
                                
                                <div class="zone-legend-item" data-zone="teleport" style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 2em;">üåÄ</span>
                                        <div>
                                            <strong style="display: block;">Teleport Zone</strong>
                                            <small style="opacity: 0.9;">Instantly transports pieces to linked location</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="zone-legend-item" data-zone="trap" style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 2em;">üîí</span>
                                        <div>
                                            <strong style="display: block;">Trap Zone</strong>
                                            <small style="opacity: 0.9;">Pieces become immobilized when entering</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="zone-legend-item" data-zone="goal" style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 2em;">üéØ</span>
                                        <div>
                                            <strong style="display: block;">Goal/Exit Zone</strong>
                                            <small style="opacity: 0.9;">Reach here to win or score points</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="zone-legend-item" data-zone="collectable" style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 2em;">‚≠ê</span>
                                        <div>
                                            <strong style="display: block;">Collectible</strong>
                                            <small style="opacity: 0.9;">Collect items from these hexes</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="zone-legend-item" data-zone="oneway" style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 2em;">‚û°Ô∏è</span>
                                        <div>
                                            <strong style="display: block;">One-Way</strong>
                                            <small style="opacity: 0.9;">Can only move in specific direction</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="zone-legend-item" data-zone="slide" style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 2em;">üßä</span>
                                        <div>
                                            <strong style="display: block;">Slide/Ice</strong>
                                            <small style="opacity: 0.9;">Pieces slide until hitting obstacle</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="zone-legend-item" data-zone="boost" style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 2em;">‚ö°</span>
                                        <div>
                                            <strong style="display: block;">Boost Zone</strong>
                                            <small style="opacity: 0.9;">Double movement range</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="zone-legend-item" data-zone="slow" style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 2em;">üêå</span>
                                        <div>
                                            <strong style="display: block;">Slow Zone</strong>
                                            <small style="opacity: 0.9;">Reduced movement (mud/swamp)</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="zone-legend-item" data-zone="damage" style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 2em;">üí•</span>
                                        <div>
                                            <strong style="display: block;">Damage Zone</strong>
                                            <small style="opacity: 0.9;">Hurts pieces when entering</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="zone-legend-item" data-zone="heal" style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 2em;">üíö</span>
                                        <div>
                                            <strong style="display: block;">Heal Zone</strong>
                                            <small style="opacity: 0.9;">Restores piece health</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="zone-legend-item" data-zone="spawn" style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 2em;">üîÑ</span>
                                        <div>
                                            <strong style="display: block;">Spawn Point</strong>
                                            <small style="opacity: 0.9;">Pieces respawn here</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="zone-legend-item" data-zone="checkpoint" style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; display: none;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 2em;">üö©</span>
                                        <div>
                                            <strong style="display: block;">Checkpoint</strong>
                                            <small style="opacity: 0.9;">Save progress point</small>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                        <small style="opacity: 0.9;">üí° <strong>Tip:</strong> This legend will automatically update based on the zones you use in your game.</small>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üéÆ Game Mechanics (Casual Game Features)</h2>
                <p style="color: #666; margin-bottom: 15px;">Configure special mechanics for puzzle, casual, or race-style games</p>
                
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="mechanicMoveOnly">
                    <label for="mechanicMoveOnly">üö∂ Move Only (no capturing) - Pieces can only move, never attack or capture</label>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="mechanicStacking">
                    <label for="mechanicStacking">üìö Stacking System - Allow multiple pieces on same hex</label>
                </div>
                
                <div class="control-group" id="stackLimitGroup" style="margin-left: 30px; display: none;">
                    <label>Maximum Stack Size per Hex</label>
                    <input type="number" id="maxStackSize" min="1" max="10" value="6">
                    <small>How many pieces can occupy the same hex (1-10)</small>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="mechanicPickup">
                    <label for="mechanicPickup">üéØ Move & Pickup - Pieces collect items or other pieces when moving over them</label>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="mechanicTrapped">
                    <label for="mechanicTrapped">üîí Trapped/Stuck - Pieces can become immobilized (e.g., surrounded, frozen)</label>
                </div>
                
                <div class="control-group" id="trapConditionGroup" style="margin-left: 30px; display: none;">
                    <label>Trap Condition</label>
                    <select id="trapCondition">
                        <option value="surrounded">Surrounded by enemy pieces (all adjacent hexes)</option>
                        <option value="adjacent">Any enemy adjacent (touching)</option>
                        <option value="zone">Specific zone type traps pieces</option>
                        <option value="custom">Custom trap rule</option>
                    </select>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="mechanicEscape">
                    <label for="mechanicEscape">üèÉ Escape Goal - Pieces must reach exit/goal zone to score/win</label>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="mechanicTeleport">
                    <label for="mechanicTeleport">üåÄ Teleport Zones - Special zones that transport pieces to other locations</label>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="mechanicPush">
                    <label for="mechanicPush">‚¨ÜÔ∏è Push/Pull - Pieces can push/pull other pieces (like Sokoban)</label>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="mechanicOneWay">
                    <label for="mechanicOneWay">‚û°Ô∏è One-Way Movement - Pieces can only move in certain directions</label>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="mechanicTimedMoves">
                    <label for="mechanicTimedMoves">‚è±Ô∏è Timed Challenges - Race mode with countdown timer</label>
                </div>
                
                <div class="control-group" id="timedDurationGroup" style="margin-left: 30px; display: none;">
                    <label>Time Limit (seconds)</label>
                    <input type="number" id="timedDuration" min="10" max="600" value="60">
                    <small>How long players have to complete the challenge</small>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="mechanicCollectibles">
                    <label for="mechanicCollectibles">‚≠ê Collectibles - Players must collect items/stars to win</label>
                </div>
                
                <div class="control-group" id="collectiblesCountGroup" style="margin-left: 30px; display: none;">
                    <label>Items to Collect</label>
                    <input type="number" id="collectiblesCount" min="1" max="50" value="5">
                    <small>Number of collectibles needed to win</small>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="mechanicTurnLimit">
                    <label for="mechanicTurnLimit">üî¢ Move Limit - Limited number of moves to complete puzzle</label>
                </div>
                
                <div class="control-group" id="moveLimitGroup" style="margin-left: 30px; display: none;">
                    <label>Maximum Moves Allowed</label>
                    <input type="number" id="maxMovesAllowed" min="1" max="100" value="20">
                    <small>Puzzle must be solved within this many moves</small>
                </div>
            </div>

            <div class="section">
                <h2>Custom Rules (Optional)</h2>
                <div class="control-group">
                    <label>Additional Rules & Mechanics</label>
                    <textarea id="customRules" rows="6" placeholder="Add any special rules, mechanics, or clarifications here..."></textarea>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="goToStep(2)">‚Üê Back</button>
                <button class="btn btn-success" onclick="goToStep(4)">Next: Test & Publish ‚Üí</button>
            </div>
        </div>

        <!-- STEP 5: Test & Publish -->
        <div class="content" id="step-4">
            <div class="section">
                <h2>üöÄ Test & Publish Your Game</h2>
                <div class="btn-group">
                    <button class="btn" onclick="generateGameConfig()">
                        üîç Preview Configuration
                    </button>
                    <button class="btn btn-warning" onclick="testGame()">
                        üéÆ Test Play Game
                    </button>
                    <button class="btn btn-success" onclick="publishGame()">
                        üåê Publish to Library
                    </button>
                    <button class="btn btn-secondary" onclick="downloadJSON()">
                        üíæ Download JSON
                    </button>
                </div>

                <div id="configPreview" style="margin-top: 30px;"></div>
            </div>

            <div class="section">
                <h2>üìã Publish Settings</h2>
                <div class="controls">
                    <div class="control-group">
                        <label>Visibility</label>
                        <select id="gameVisibility">
                            <option value="public">Public (anyone can play)</option>
                            <option value="unlisted">Unlisted (only with link)</option>
                            <option value="private">Private (only you)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Thumbnail URL (optional)</label>
                        <input type="text" id="gameThumbnail" placeholder="https://...">
                        <small>Image to show in game library</small>
                    </div>
                </div>

                <div class="checkbox-wrapper">
                    <input type="checkbox" id="agreeTerms" checked>
                    <label for="agreeTerms">I agree to share this game publicly and allow others to play it</label>
                </div>
            </div>

            <div class="section">
                <h2>üìñ Integration Instructions</h2>
                <div class="alert alert-info">
                    <strong>After publishing, your game will be:</strong><br><br>
                    ‚úì Available in the Game Library<br>
                    ‚úì Playable via direct link: <code>romgon.net/play?game=YOUR_GAME_ID</code><br>
                    ‚úì Searchable and rateable by other players<br>
                    ‚úì Saved to your account (if logged in)<br><br>
                    <strong>Players can:</strong><br>
                    ‚Ä¢ Play against AI or friends<br>
                    ‚Ä¢ Rate and favorite your game<br>
                    ‚Ä¢ Share the link with others<br>
                    ‚Ä¢ Report issues or suggestions
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="goToStep(3)">‚Üê Back</button>
                <button class="btn" onclick="startNewGame()">üîÑ Create Another Game</button>
            </div>
        </div>
    </div>

    <!-- Publish Success Modal -->
    <div id="publishModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('publishModal')">&times;</span>
            <h2>üéâ Game Published Successfully!</h2>
            <div id="publishResult"></div>
            <div class="btn-group" style="margin-top: 20px;">
                <button class="btn btn-success" id="playGameBtn">Play Now</button>
                <button class="btn" id="shareGameBtn">Share Link</button>
                <button class="btn btn-secondary" onclick="closeModal('publishModal')">Close</button>
            </div>
        </div>
    </div>

    <script src="game-creator.js?v=3.4"></script>
</body>
</html>
